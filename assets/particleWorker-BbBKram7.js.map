{"version":3,"file":"particleWorker-BbBKram7.js","sources":["../src/particleWorker.ts"],"sourcesContent":["// 粒子计算工作线程 - TypeScript版本\n\ninterface AmbientParticle {\n    x: number;\n    y: number;\n    r: number;\n    alpha: number;\n    vx: number;\n    vy: number;\n}\n\ninterface HitEffectParticle {\n    x: number;\n    y: number;\n    vx: number;\n    vy: number;\n    life: number;\n    decay: number;\n    size: number;\n    color: string;\n    isExplosion?: boolean;\n}\n\ninterface WorkerMessage {\n    type: 'initAmbient' | 'updateAmbient' | 'createHit' | 'updateHit' | 'hitCreate' | 'clearHit';\n    data: any;\n}\n\ninterface InitAmbientData {\n    count: number;\n    width: number;\n    height: number;\n}\n\ninterface UpdateAmbientData {\n    width: number;\n    height: number;\n}\n\ninterface CreateHitData {\n    x: number;\n    y: number;\n    color: string;\n    laneWidth: number;\n}\n\ninterface UpdateHitData {\n    height: number;\n}\n\nclass ParticleWorker {\n    private hitEffects: HitEffectParticle[] = [];\n    private ambientParticles: AmbientParticle[] = [];\n\n    initAmbient(count: number, width: number, height: number): void {\n        this.ambientParticles = [];\n        for (let i = 0; i < count; i++) {\n            this.ambientParticles.push({\n                x: Math.random() * width,\n                y: Math.random() * height,\n                r: 1.5 + Math.random() * 2.5,\n                alpha: 0.10 + Math.random() * 0.15,\n                vx: (Math.random() - 0.5) * 0.15,\n                vy: -0.05 - Math.random() * 0.35\n            });\n        }\n    }\n\n    updateAmbient(width: number, height: number): AmbientParticle[] {\n        for (const p of this.ambientParticles) {\n            p.x += p.vx;\n            p.y += p.vy;\n            if (p.y < -10) {\n                p.x = Math.random() * width;\n                p.y = height + 10;\n                p.vx = (Math.random() - 0.5) * 0.15;\n                p.vy = -0.05 - Math.random() * 0.15;\n                p.r = 1.5 + Math.random() * 2.5;\n                p.alpha = 0.10 + Math.random() * 0.15;\n            }\n            if (p.x < -10 || p.x > width + 10) {\n                p.vx *= -1;\n            }\n        }\n        return this.ambientParticles;\n    }\n\n    createHit(x: number, y: number, color: string, laneWidth: number): HitEffectParticle[] {\n        const particleCount = 30;\n        const newParticles: HitEffectParticle[] = [];\n\n        for (let i = 0; i < particleCount; i++) {\n            const angle = -Math.PI / 2 + (Math.random() - 0.5) * (Math.PI / 2);\n            const base = 0.8;\n            const speed = base * Math.sqrt(Math.random());\n            const vx = Math.cos(angle) * speed * 0.8;\n            const vy = Math.sin(angle) * speed;\n\n            newParticles.push({\n                x, y, vx, vy,\n                life: 1.5,\n                decay: 0.02 + Math.random() * 0.02,\n                size: (laneWidth / 2 - 5) + Math.random() * 7,\n                color\n            });\n        }\n\n        newParticles.push({\n            x, y, vx: -0.2, vy: 0,\n            life: 10,\n            decay: 0.6,\n            size: Math.random() * 10,\n            color,\n            isExplosion: true\n        });\n\n        this.hitEffects.push(...newParticles);\n        return this.hitEffects;\n    }\n\n    updateHit(height: number): HitEffectParticle[] {\n        const next: HitEffectParticle[] = [];\n        for (const e of this.hitEffects) {\n            e.x += e.vx;\n            e.y += e.vy;\n            e.vy += 0.05;\n            e.life -= e.decay;\n            if (e.isExplosion) e.size *= 0.9;\n            else e.size *= 0.93;\n\n            if (e.life > 0 && e.y > 30 && e.y < height + 30) {\n                next.push(e);\n            }\n        }\n        this.hitEffects = next;\n        return this.hitEffects;\n    }\n\n    clearHit(): HitEffectParticle[] {\n        this.hitEffects = [];\n        return this.hitEffects;\n    }\n}\n\nconst worker = new ParticleWorker();\n\nself.onmessage = function (e: MessageEvent<WorkerMessage>) {\n    const { type, data } = e.data;\n\n    switch (type) {\n        case 'initAmbient':\n            worker.initAmbient(\n                (data as InitAmbientData).count,\n                (data as InitAmbientData).width,\n                (data as InitAmbientData).height\n            );\n            self.postMessage({ type: 'ambientInit', data: worker['ambientParticles'] });\n            break;\n\n        case 'updateAmbient':\n            const ambient = worker.updateAmbient(\n                (data as UpdateAmbientData).width,\n                (data as UpdateAmbientData).height\n            );\n            self.postMessage({ type: 'ambientUpdate', data: ambient });\n            break;\n\n        case 'createHit':\n            const newHits = worker.createHit(\n                (data as CreateHitData).x,\n                (data as CreateHitData).y,\n                (data as CreateHitData).color,\n                (data as CreateHitData).laneWidth\n            );\n            self.postMessage({ type: 'hitCreate', data: newHits });\n            break;\n\n        case 'updateHit':\n            const updatedHits = worker.updateHit((data as UpdateHitData).height);\n            self.postMessage({ type: 'hitUpdate', data: updatedHits });\n            break;\n\n        case 'clearHit':\n            const clearedHits = worker.clearHit();\n            self.postMessage({ type: 'hitUpdate', data: clearedHits });\n            break;\n    }\n};\n"],"names":["ParticleWorker","__publicField","count","width","height","p","x","y","color","laneWidth","newParticles","i","angle","speed","vx","vy","next","e","worker","type","data","ambient","newHits","updatedHits","clearedHits"],"mappings":"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"}