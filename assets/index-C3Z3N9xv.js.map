{"version":3,"mappings":"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","names":["con_height","gameCanvas","settingsPanel","playbackPanel","is_clicked","info_panel","song_infos","song_info","startup_can","OSZParser","__publicField","file","JSZip","zip","foundAudioFilenames","allFiles","filename","fileData","content","audioMatch","audioFilename","audioFileEntry","f","blob","ext","error","resolve","reject","reader","e","PCZParser","jsonExtensions","foundBeatmap","lowerFilename","audioExtensions","foundAudio","firstBeatmap","imageExtensions","foundBackground","isBgFile","bgFilename","bgFileEntry","BaseBeatmapParser","sv","hitObjects","xs","obj","objs","originalKeyCount","originalColumn","x","newColumn","originalCol","currentGroup","lastTime","timeThreshold","measures","measureIndex","measuresPerGroup","measuresInCurrentGroup","subdivisions","groupsPerMeasure","measureStart","measureDuration","positionInMeasure","subMeasureIndex","globalGroupIndex","groupSize","beatmap","tp","baseSV","changeTimes","point","svAt","t","i","raw","times","a","b","segments","cumAreas","start","end","currentSV","merged","seg","last","cum","duration","increment","firstRed","p","baseBPM","getBPMAndSV","bpm","combinedMultiplier","timingPoints","uniqueTimingPoints","seenTimes","processedTimingPoints","currentBpm","adjustedBeatLength","reds","lastObjTime","max","objEnd","segStart","segEnd","measureLen","OSUBeatmapParser","lines","currentSection","line","rawTP","target","key","rest","value","difficulty","num","parts","time","beatLength","meter","uninherited","type","isLongNote","endTimeStr","JSONBeatmapParser","jsonData","jsonMetadata","metadata","jsonGeneral","general","jsonDifficulty","jsonPoints","jsonObjects","hitObject","keyGroups","objectMap","index","group","objId","g","BeatmapParserFactory","trimmedContent","parsed","hasFormatVersion","hasObjectsField","hasVersionLine","hasSectionMarkers","hasKeyValuePairs","trimmed","extension","contents","AudioManager","audioBlob","url","name","arrayBuffer","audioBuffer","volume","soundData","source","gainNode","startTime","rate","GameRenderer","canvas","data","column","keyGroupColor","totalWidth","y","color","particleCount","angle","speed","vx","vy","rect","dpr","offset","show","use","stats","set","img","segs","areas","idx","lo","hi","mid","s","base","clampedT","k","dt","areaFunc","aNote","aNow","currentTime","now","step","next","iw","ih","scale","drawW","drawH","dx","dy","haze","startX","noteWidth","noteHeight","fadeEarly","calcAlpha","hitTime","timeToHit","alpha","fadeProgress","headY","tailY","visibleHeadY","visibleTailY","bodyTop","bodyBottom","bodyLen","grad","w","h","alphaFactor","distance","baseAlpha","gradient","amount","hex","r","measureTime","adjustedMeasureTime","enabled","renderLoop","deltaTime","fixedDeltaTime","targetFrameTime","interpolatedTime","fps","Game","settings","saved","offsetSlider","measureOffsetSlider","langSelect","message","toast","escPressTimer","col","list","diff","result","diffMs","j","isHead","weightMap","scoreAddMap","weight","scoreAdd","colors","files","bmData","select","bm","option","audioLeadInStr","audioLeadIn","c","Creator","Artist","Title","Version","ev","overlay","startHandler","wasNaturalEnd","score","resultLeftElement","rawTime","leadIn","audioLeadInInfo","audioLeadInValue","delta","newOffset","totalOffset","displayText","loop","rawCurrentTime","progress","seconds","mins","secs","resources","isElectron","i18next","__vitePreload","savedSettings","savedLanguage","updateContent","el","lang"],"ignoreList":[],"sources":["../../renderer.js","../../src/oszParser.ts","../../src/pczParser.ts","../../src/beatmapParser.ts","../../src/osuParser.ts","../../src/jsonParser.ts","../../src/parserFactory.ts","../../src/audioManager.ts","../../src/gameRenderer.ts","../../src/main.ts","../../i18essential.js"],"sourcesContent":["\nwindow.addEventListener(\"DOMContentLoaded\", () => {\n    const con_height = window.innerHeight;\n    const gameCanvas = document.getElementById(\"gameCanvas\");\n    gameCanvas.style.height = (con_height - 8) + \"px\";\n\n});\n\nwindow.addEventListener(\"resize\", () => {\n    const con_height = window.innerHeight;\n    const gameCanvas = document.getElementById(\"gameCanvas\");\n    gameCanvas.style.height = (con_height - 8) + \"px\";\n\n});\ndocument.addEventListener('DOMContentLoaded', () => {\n    const settingsPanel = document.querySelector('.settings-panel');\n    const playbackPanel = document.querySelector('.playback-controls');\n    const header = settingsPanel.querySelector('.settings-header');\n    header.addEventListener('click', () => {\n        settingsPanel.classList.toggle('active');\n        playbackPanel.classList.toggle('active');\n    });\n    let is_clicked = false;\n    document.getElementById(\"songTitle\").addEventListener('click', () => {\n        const info_panel = document.getElementsByClassName(\"info-panel\")[0];\n        const song_infos = document.getElementsByClassName(\"song-info\")[0];\n        const song_info = document.getElementById(\"songTitle\");\n        const startup_can = document.getElementById(\"StartupCanvas\");\n        if (is_clicked === false) {\n            info_panel.style.bottom = `30px`;\n            song_infos.style.paddingLeft = \"6px\";\n            settingsPanel.style.opacity = 0;\n            info_panel.style.background = \"rgba(248,249,250,0)\";\n            song_info.style.color = \"#505598\";\n            startup_can.style.opacity = \"0\";\n            song_infos.style.borderStyle = \"solid\"\n            song_infos.style.boxShadow = `#333333 -3px 4px 2px`;\n            song_infos.style.background = `rgba(156, 156, 156, 0.8)`;\n            is_clicked = true;\n        } else if (is_clicked === true) {\n            info_panel.style.bottom = `0px`;\n            song_infos.style.paddingLeft = \"0px\";\n            settingsPanel.style.opacity = 1;\n            info_panel.style.background = \"rgba(248, 249, 250, 0.65)\";\n            song_info.style.color = \"#34449e\";\n            startup_can.style.opacity = \"inherit\";\n            song_infos.style.borderStyle = \"none\";\n            song_infos.style.boxShadow = `none`;\n            song_infos.style.background = `#00000000`;\n            is_clicked = false;\n        }\n    });\n});\n// document.addEventListener('DOMContentLoaded', () => {\n//     const container = document.querySelector('.container');\n//     enableDrag(document.getElementById('draggablePanel'), container);\n//     enableDrag(document.getElementById('draggableSettings'), container);\n// });\n\n/**\n *  container \n */\n// function enableDrag(el, container) {\n//     let active = false;\n//     let offsetX = 0, offsetY = 0;\n//\n//     el.addEventListener('mousedown', e => {\n//         if (e.target.tagName === 'INPUT' || e.target.tagName === 'BUTTON') return;\n//         active = true;\n//         el.classList.add('dragging');\n//         // \n//         const rect = el.getBoundingClientRect();\n//         offsetX = e.clientX - rect.left;\n//         offsetY = e.clientY - rect.top;\n//         e.preventDefault();\n//     });\n//\n//     document.addEventListener('mousemove', e => {\n//         if (!active) return;\n//         const containerRect = container.getBoundingClientRect();\n//         const elRect = el.getBoundingClientRect();\n//         let left = e.clientX - containerRect.left - offsetX;\n//         let top = e.clientY - containerRect.top - offsetY;\n//\n//         // \n//         if (left < 0) left = 0;\n//         if (top < 0) top = 0;\n//         if (left + elRect.width > containerRect.width) left = containerRect.width - elRect.width;\n//         if (top + elRect.height > containerRect.height) top = containerRect.height - elRect.height;\n//\n//         el.style.left = left + 'px';\n//         el.style.top = top + 'px';\n//     });\n//\n//     document.addEventListener('mouseup', () => {\n//         if (active) {\n//             active = false;\n//             el.classList.remove('dragging');\n//         }\n//     });\n// }\n\n","// OSZ - TypeScript\n\ninterface BeatmapFile {\n    filename: string;\n    content: string;\n    audioFilename?: string | null;\n}\n\ninterface AudioFile {\n    filename: string;\n    blob: Blob;\n}\n\ninterface BackgroundFile {\n    filename: string;\n    blob: Blob;\n}\n\ninterface OSZFiles {\n    beatmaps?: BeatmapFile[];\n    audio?: AudioFile;\n    background?: BackgroundFile;\n}\n\n// JSZip\ndeclare const JSZip: any;\n\nexport class OSZParser {\n    private zip: any = null;\n    private files: OSZFiles = {};\n\n    constructor() {\n        this.zip = null;\n        this.files = {};\n    }\n\n    async loadOSZ(file: File): Promise<OSZFiles> {\n        const JSZip = (window as any).JSZip;\n        this.zip = new JSZip();\n\n        try {\n            const zip = await this.zip.loadAsync(file);\n            this.files = {};\n            const foundAudioFilenames = new Set<string>();\n\n            // \n            const allFiles = Object.keys(zip.files);\n\n            //  .osu \n            for (const [filename, fileData] of Object.entries(zip.files) as [string, any][]) {\n                if (fileData.dir) continue;\n\n                const ext = filename.split('.').pop()!.toLowerCase();\n                if (ext !== 'osu') continue;\n\n                const content = await fileData.async('string');\n                const audioMatch = content.match(/AudioFilename\\s*:\\s*(.+)/i);\n                const audioFilename = audioMatch ? audioMatch[1].trim() : null;\n\n                if (!this.files.beatmaps) this.files.beatmaps = [];\n                this.files.beatmaps.push({\n                    filename,\n                    content,\n                    audioFilename,\n                });\n\n                if (audioFilename) {\n                    foundAudioFilenames.add(audioFilename);\n                }\n            }\n\n            //  AudioFilename \n            for (const audioFilename of Array.from(foundAudioFilenames)) {\n                const audioFileEntry = allFiles.find(\n                    (f: string) => f.toLowerCase().endsWith(audioFilename.toLowerCase())\n                );\n                if (audioFileEntry) {\n                    const fileData = zip.files[audioFileEntry];\n                    const blob = await fileData.async('blob');\n                    this.files.audio = { filename: audioFileEntry, blob };\n                    break; // \n                } else {\n                    console.warn(` \"${audioFilename}\" `);\n                }\n            }\n\n            // \n            for (const [filename, fileData] of Object.entries(zip.files) as [string, any][]) {\n                if (fileData.dir) continue;\n\n                const ext = filename.split('.').pop()!.toLowerCase();\n                if (!['jpg', 'jpeg', 'png'].includes(ext)) continue;\n\n                const blob = await fileData.async('blob');\n                //  \"bg\"\n                if (filename.toLowerCase().includes('bg') || !this.files.background) {\n                    this.files.background = { filename, blob };\n                }\n            }\n\n            return this.files;\n        } catch (error) {\n            console.error('OSZ:', error);\n            throw error;\n        }\n    }\n\n    async loadSingleOSU(file: File): Promise<OSZFiles> {\n        return new Promise((resolve, reject) => {\n            const reader = new FileReader();\n            reader.onload = (e) => {\n                this.files = {\n                    beatmaps: [{\n                        filename: file.name,\n                        content: e.target!.result as string\n                    }]\n                };\n                resolve(this.files);\n            };\n            reader.onerror = reject;\n            reader.readAsText(file);\n        });\n    }\n\n    getFiles(): OSZFiles {\n        return this.files;\n    }\n}\n","interface PCZBeatmapFile {\n    filename: string;\n    content: string;\n}\n\ninterface PCZAudioFile {\n    filename: string;\n    blob: Blob;\n}\n\ninterface PCZBackgroundFile {\n    filename: string;\n    blob: Blob;\n}\n\ninterface PCZFiles {\n    beatmaps?: PCZBeatmapFile[];\n    audio?: PCZAudioFile;\n    background?: PCZBackgroundFile;\n}\n\n// JSZip\ndeclare const JSZip: any;\n\nexport class PCZParser {\n    private zip: any = null;\n    private files: PCZFiles = {};\n\n    constructor() {\n        this.zip = null;\n        this.files = {};\n    }\n\n    /**\n     * PCZ\n     * @param file PCZzip\n     * @returns \n     */\n    async loadPCZ(file: File): Promise<PCZFiles> {\n        const JSZip = (window as any).JSZip;\n        this.zip = new JSZip();\n\n        try {\n            const zip = await this.zip.loadAsync(file);\n            this.files = {};\n            const allFiles = Object.keys(zip.files);\n\n            // JSON\n            const jsonExtensions = ['.4key.json', '.json', '.4key'];\n            let foundBeatmap = false;\n\n            for (const [filename, fileData] of Object.entries(zip.files) as [string, any][]) {\n                if (fileData.dir) continue;\n\n                const lowerFilename = filename.toLowerCase();\n\n                // JSON\n                const isJsonFile = jsonExtensions.some(ext => lowerFilename.endsWith(ext));\n\n                if (isJsonFile) {\n                    const content = await fileData.async('string');\n\n                    if (!this.files.beatmaps) this.files.beatmaps = [];\n                    this.files.beatmaps.push({\n                        filename,\n                        content,\n                    });\n                    foundBeatmap = true;\n                }\n            }\n\n            // JSON.osu\n            if (!foundBeatmap) {\n                for (const [filename, fileData] of Object.entries(zip.files) as [string, any][]) {\n                    if (fileData.dir) continue;\n\n                    if (filename.toLowerCase().endsWith('.osu')) {\n                        const content = await fileData.async('string');\n\n                        if (!this.files.beatmaps) this.files.beatmaps = [];\n                        this.files.beatmaps.push({\n                            filename,\n                            content,\n                        });\n                        foundBeatmap = true;\n                    }\n                }\n            }\n\n            // \n            if (!foundBeatmap) {\n                throw new Error('.4key.json, .json, .4key, .osu');\n            }\n\n            // \n            const audioExtensions = ['.mp3', '.wav', '.ogg', '.flac', '.m4a', '.aac'];\n            let foundAudio = false;\n\n            for (const [filename, fileData] of Object.entries(zip.files) as [string, any][]) {\n                if (fileData.dir) continue;\n\n                const lowerFilename = filename.toLowerCase();\n                const isAudioFile = audioExtensions.some(ext => lowerFilename.endsWith(ext));\n\n                if (isAudioFile) {\n                    const blob = await fileData.async('blob');\n                    this.files.audio = {filename, blob};\n                    foundAudio = true;\n                    break; // \n                }\n            }\n\n            // JSON\n            if (!foundAudio && this.files.beatmaps && this.files.beatmaps.length > 0) {\n                try {\n                    const firstBeatmap = JSON.parse(this.files.beatmaps[0].content);\n                    if (firstBeatmap.general?.audioFilename) {\n                        const audioFilename = firstBeatmap.general.audioFilename;\n                        const audioFileEntry = allFiles.find(\n                            (f: string) => f.toLowerCase().endsWith(audioFilename.toLowerCase())\n                        );\n\n                        if (audioFileEntry) {\n                            const fileData = zip.files[audioFileEntry];\n                            const blob = await fileData.async('blob');\n                            this.files.audio = {filename: audioFileEntry, blob};\n                            foundAudio = true;\n                        }\n                    }\n                } catch (error) {\n                    console.warn('JSON:', error);\n                }\n            }\n\n            // \n            const imageExtensions = ['.png', '.jpg', '.jpeg', '.gif', '.bmp', '.webp'];\n            let foundBackground = false;\n\n            for (const [filename, fileData] of Object.entries(zip.files) as [string, any][]) {\n                if (fileData.dir) continue;\n\n                const lowerFilename = filename.toLowerCase();\n                const isImageFile = imageExtensions.some(ext => lowerFilename.endsWith(ext));\n\n                if (isImageFile) {\n                    const blob = await fileData.async('blob');\n\n                    //  \"bg\"  \"background\" \n                    const isBgFile = lowerFilename.includes('bg') || lowerFilename.includes('background');\n\n                    if (isBgFile || !this.files.background) {\n                        this.files.background = {filename, blob};\n                        if (isBgFile) {\n                            foundBackground = true;\n                            break; // \n                        }\n                    }\n                }\n            }\n\n            // \n            if (!foundBackground && this.files.background) {\n                // \n                foundBackground = true;\n            }\n\n            // JSON\n            if (!foundBackground && this.files.beatmaps && this.files.beatmaps.length > 0) {\n                try {\n                    const firstBeatmap = JSON.parse(this.files.beatmaps[0].content);\n                    if (firstBeatmap.events?.background?.filename) {\n                        const bgFilename = firstBeatmap.events.background.filename;\n                        const bgFileEntry = allFiles.find(\n                            (f: string) => f.toLowerCase().endsWith(bgFilename.toLowerCase())\n                        );\n\n                        if (bgFileEntry) {\n                            const fileData = zip.files[bgFileEntry];\n                            const blob = await fileData.async('blob');\n                            this.files.background = {filename: bgFileEntry, blob};\n                        }\n                    }\n                } catch (error) {\n                    console.warn('JSON:', error);\n                }\n            }\n\n            return this.files;\n        } catch (error) {\n            console.error('PCZ:', error);\n            throw error;\n        }\n    }\n\n    /**\n     * JSON\n     * @param file JSON\n     * @returns \n     */\n    async loadSingleJSON(file: File): Promise<PCZFiles> {\n        return new Promise((resolve, reject) => {\n            const reader = new FileReader();\n            reader.onload = (e) => {\n                this.files = {\n                    beatmaps: [{\n                        filename: file.name,\n                        content: e.target!.result as string\n                    }]\n                };\n                resolve(this.files);\n            };\n            reader.onerror = reject;\n            reader.readAsText(file);\n        });\n    }\n\n    /**\n     * \n     * @returns \n     */\n    getFiles(): PCZFiles {\n        return this.files;\n    }\n\n    /**\n     * PCZ\n     * @param file \n     * @returns PCZ\n     */\n    static isPCZFile(file: File): boolean {\n        const extension = file.name.split('.').pop()!.toLowerCase();\n        return extension === 'pcz';\n    }\n\n    /**\n     * JSON\n     * @param file \n     * @returns JSON\n     */\n    static isJSONBeatmapFile(file: File): boolean {\n        const filename = file.name.toLowerCase();\n        return filename.endsWith('.4key.json') ||\n            filename.endsWith('.json') ||\n            filename.endsWith('.4key');\n    }\n}\n","// Beatmap - TypeScript\n\nexport interface TimingPoint {\n  time: number;\n  beatLength: number;\n  meter: number;\n  uninherited: boolean;\n}\n\nexport interface HitObject {\n  x: number;\n  time: number;\n  type: number;\n  isLongNote: boolean;\n  endTime: number;\n  column: number;\n  keyGroup: number;\n  judgedHead?: boolean;\n  judgedTail?: boolean;\n}\n\nexport interface SVSegment {\n  start: number;\n  end: number;\n  sv: number;\n}\n\nexport interface Beatmap {\n  metadata: Record<string, string>;\n  general: Record<string, string>;\n  difficulty: Record<string, number | string>;\n  timingPoints: TimingPoint[];\n  rawTimingPointsForSV?: TimingPoint[];\n  hitObjects: HitObject[];\n  keyCount: number;\n  svSegments: SVSegment[];\n  svCumAreas: number[];\n  combinedSegments: SVSegment[];\n  combinedCumAreas: number[];\n  measures?: number[];\n}\n\n// \nexport interface IBeatmapParser {\n  parse(content: string): Beatmap;\n  getBeatmap(): Beatmap | null;\n}\n\n// \nexport abstract class BaseBeatmapParser implements IBeatmapParser {\n  protected beatmap: Beatmap | null = null;\n\n  constructor() {\n    this.beatmap = null;\n  }\n\n  abstract parse(content: string): Beatmap;\n\n  getBeatmap(): Beatmap | null {\n    return this.beatmap;\n  }\n\n  // \n  protected clampSV(sv: number): number {\n    const MIN_SV = 0.001;\n    const MAX_SV = 30.0;\n    return Math.max(MIN_SV, Math.min(MAX_SV, sv));\n  }\n\n  protected calculateKeyCount(hitObjects: HitObject[]): number {\n    const xs = hitObjects.map((obj) => Math.floor((obj.x * 8) / 512));\n    const uniqueXs = new Set(xs);\n    return uniqueXs.size;\n  }\n\n  protected convertTo4Key(\n    objs: HitObject[],\n    originalKeyCount: number,\n  ): HitObject[] {\n    const originalColumn = (x: number) =>\n      Math.floor((x * originalKeyCount) / 512);\n    const newColumn = (originalCol: number) =>\n      Math.floor((originalCol * 4) / originalKeyCount);\n    return objs.map((obj) => ({\n      ...obj,\n      x: Math.floor((obj.x * 4) / originalKeyCount),\n      column: newColumn(originalColumn(obj.x)),\n    }));\n  }\n\n  protected calculateKeyGroups(hitObjects: HitObject[]): void {\n    let currentGroup = 0;\n    let lastTime = -Infinity;\n    const timeThreshold = 150; // ms\n\n    for (const obj of hitObjects) {\n      if (obj.time - lastTime > timeThreshold) {\n        currentGroup++;\n      }\n      obj.keyGroup = currentGroup;\n      lastTime = obj.time;\n    }\n  }\n\n  protected calculateKeyGroupsByMeasure(\n    hitObjects: HitObject[],\n    measures: number[],\n  ): void {\n    let currentGroup = 0;\n    let measureIndex = 0;\n\n    for (const obj of hitObjects) {\n      // \n      while (\n        measureIndex < measures.length - 1 &&\n        obj.time >= measures[measureIndex + 1]\n      ) {\n        measureIndex++;\n        currentGroup++;\n      }\n      obj.keyGroup = currentGroup;\n    }\n  }\n\n  protected calculateKeyGroupsByMeasureGroups(\n    hitObjects: HitObject[],\n    measures: number[],\n    measuresPerGroup: number = 8,\n  ): void {\n    let currentGroup = 0;\n    let measureIndex = 0;\n    let measuresInCurrentGroup = 0;\n\n    for (const obj of hitObjects) {\n      // \n      while (\n        measureIndex < measures.length - 1 &&\n        obj.time >= measures[measureIndex + 1]\n      ) {\n        measureIndex++;\n        measuresInCurrentGroup++;\n\n        //  measuresPerGroup \n        if (measuresInCurrentGroup >= measuresPerGroup) {\n          currentGroup++;\n          measuresInCurrentGroup = 0;\n        }\n      }\n      obj.keyGroup = currentGroup;\n    }\n  }\n\n  protected calculateKeyGroupsBySubMeasures(\n    hitObjects: HitObject[],\n    measures: number[],\n    subdivisions: number = 16,\n  ): void {\n    if (measures.length < 2) {\n      // \n      this.calculateKeyGroups(hitObjects);\n      return;\n    }\n\n    let measureIndex = 0;\n    const groupsPerMeasure = 8; // 8\n\n    for (const obj of hitObjects) {\n      // \n      while (\n        measureIndex < measures.length - 1 &&\n        obj.time >= measures[measureIndex + 1]\n      ) {\n        measureIndex++;\n      }\n\n      // \n      const measureStart = measures[measureIndex];\n      const measureEnd =\n        measureIndex + 1 < measures.length\n          ? measures[measureIndex + 1]\n          : measureStart + (60000 / 120) * 4; // 4/4120BPM\n\n      const measureDuration = measureEnd - measureStart;\n      const positionInMeasure = obj.time - measureStart;\n\n      // 1/subdivisionssubdivisions\n      const subMeasureIndex = Math.floor(\n        (positionInMeasure / measureDuration) * subdivisions,\n      );\n\n      // measureIndex * subdivisions + subMeasureIndex\n      const globalGroupIndex = measureIndex * subdivisions + subMeasureIndex;\n\n      //  (subdivisions / groupsPerMeasure) \n      // subdivisions=16, groupsPerMeasure=8 => 2\n      const groupSize = subdivisions / groupsPerMeasure;\n      obj.keyGroup = Math.floor(globalGroupIndex / groupSize);\n    }\n  }\n\n  protected buildSVSegments(beatmap: Beatmap): void {\n    const tp = beatmap.rawTimingPointsForSV || beatmap.timingPoints;\n    const baseSV = 1.0;\n\n    // \n    const changeTimes = new Set<number>();\n    changeTimes.add(0);\n    for (const point of tp) {\n      changeTimes.add(point.time);\n    }\n\n    // SV\n    const svAt = (t: number): number => {\n      let sv = baseSV;\n      for (let i = tp.length - 1; i >= 0; i--) {\n        const raw = tp[i];\n        if (raw.time <= t) {\n          if (!raw.uninherited) {\n            sv = this.clampSV(-100 / raw.beatLength);\n          }\n          break;\n        }\n      }\n      return sv;\n    };\n\n    const times = Array.from(changeTimes).sort((a, b) => a - b);\n    const segments: SVSegment[] = [];\n    const cumAreas: number[] = [];\n\n    for (let i = 0; i < times.length; i++) {\n      const start = times[i];\n      const end = i + 1 < times.length ? times[i + 1] : Infinity;\n      const currentSV = svAt(start);\n\n      segments.push({ start, end, sv: currentSV });\n    }\n\n    // SV\n    const merged: SVSegment[] = [];\n    for (const seg of segments) {\n      if (merged.length === 0) {\n        merged.push({ ...seg });\n      } else {\n        const last = merged[merged.length - 1];\n        if (Math.abs(last.sv - seg.sv) < 1e-6 && last.end === seg.start) {\n          last.end = seg.end;\n        } else {\n          merged.push({ ...seg });\n        }\n      }\n    }\n\n    // \n    let cum = 0;\n    for (const seg of merged) {\n      cumAreas.push(cum);\n      const duration = seg.end === Infinity ? 0 : seg.end - seg.start;\n      const increment = seg.sv * duration;\n      cum += increment;\n    }\n\n    beatmap.svSegments = merged;\n    beatmap.svCumAreas = cumAreas;\n  }\n\n  protected buildCombinedSegments(beatmap: Beatmap): void {\n    const tp = beatmap.rawTimingPointsForSV || beatmap.timingPoints;\n    const baseSV = 1.0;\n\n    // \n    const firstRed = tp.find((p) => p.uninherited);\n    const baseBPM = firstRed ? 60000 / firstRed.beatLength : 120;\n\n    // \n    const changeTimes = new Set<number>();\n    changeTimes.add(0);\n    for (const point of tp) {\n      changeTimes.add(point.time);\n    }\n\n    // BPMSV\n    const getBPMAndSV = (t: number): { bpm: number; sv: number } => {\n      let bpm = baseBPM;\n      let sv = baseSV;\n      for (let i = tp.length - 1; i >= 0; i--) {\n        const raw = tp[i];\n        if (raw.time <= t) {\n          if (raw.uninherited) {\n            bpm = 60000 / raw.beatLength;\n          } else {\n            sv = this.clampSV(-100 / raw.beatLength);\n          }\n          break;\n        }\n      }\n      return { bpm, sv };\n    };\n\n    const times = Array.from(changeTimes).sort((a, b) => a - b);\n    const segments: SVSegment[] = [];\n    const cumAreas: number[] = [];\n\n    for (let i = 0; i < times.length; i++) {\n      const start = times[i];\n      const end = i + 1 < times.length ? times[i + 1] : Infinity;\n      const { bpm, sv } = getBPMAndSV(start);\n      const combinedMultiplier = sv * (bpm / baseBPM);\n\n      segments.push({ start, end, sv: combinedMultiplier });\n    }\n\n    // \n    const merged: SVSegment[] = [];\n    for (const seg of segments) {\n      if (merged.length === 0) {\n        merged.push({ ...seg });\n      } else {\n        const last = merged[merged.length - 1];\n        if (Math.abs(last.sv - seg.sv) < 1e-6 && last.end === seg.start) {\n          last.end = seg.end;\n        } else {\n          merged.push({ ...seg });\n        }\n      }\n    }\n\n    // \n    let cum = 0;\n    for (const seg of merged) {\n      cumAreas.push(cum);\n      const duration = seg.end === Infinity ? 0 : seg.end - seg.start;\n      const increment = seg.sv * duration;\n      cum += increment;\n    }\n\n    beatmap.combinedSegments = merged;\n    beatmap.combinedCumAreas = cumAreas;\n  }\n\n  protected alignTimingPoints(timingPoints: TimingPoint[]): void {\n    const uniqueTimingPoints: TimingPoint[] = [];\n    const seenTimes = new Set<number>();\n\n    for (const tp of timingPoints) {\n      if (!seenTimes.has(tp.time)) {\n        seenTimes.add(tp.time);\n        uniqueTimingPoints.push(tp);\n      }\n    }\n\n    uniqueTimingPoints.sort((a, b) => a.time - b.time);\n\n    const processedTimingPoints: TimingPoint[] = [];\n    let currentBpm = 120;\n\n    for (const tp of uniqueTimingPoints) {\n      if (tp.uninherited) {\n        currentBpm = 60000 / tp.beatLength;\n        processedTimingPoints.push(tp);\n      } else {\n        const adjustedBpm = currentBpm;\n        const adjustedBeatLength = 60000 / adjustedBpm;\n        processedTimingPoints.push({\n          ...tp,\n          beatLength: adjustedBeatLength,\n        });\n      }\n    }\n\n    timingPoints.length = 0;\n    timingPoints.push(...processedTimingPoints);\n  }\n\n  protected calculateMeasures(beatmap: Beatmap): void {\n    const allTP = beatmap.timingPoints;\n    const reds = allTP.filter((tp) => tp.uninherited);\n    if (reds.length === 0) return;\n\n    const lastObjTime = beatmap.hitObjects.reduce((max, obj) => {\n      const objEnd = obj.isLongNote ? obj.endTime : obj.time;\n      return Math.max(max, objEnd);\n    }, 0);\n\n    const measures: number[] = [];\n    for (let i = 0; i < reds.length; i++) {\n      const tp = reds[i];\n      const segStart = tp.time;\n      const nextRedTime =\n        i + 1 < reds.length ? reds[i + 1].time : lastObjTime + 10000;\n      const segEnd = nextRedTime;\n      const measureLen = (60000 / Math.abs(tp.beatLength)) * tp.meter;\n\n      let t = segStart;\n      while (t < segEnd) {\n        measures.push(t);\n        t += measureLen;\n      }\n    }\n\n    beatmap.measures = measures;\n  }\n}\n","// OSU - TypeScript\n\nimport type { Beatmap, TimingPoint, HitObject } from \"./beatmapParser.js\";\nimport { BaseBeatmapParser } from \"./beatmapParser.js\";\n\nexport class OSUBeatmapParser extends BaseBeatmapParser {\n  parse(content: string): Beatmap {\n    const lines = content.split(\"\\n\");\n    const beatmap: Beatmap = {\n      metadata: {},\n      general: {},\n      difficulty: {},\n      timingPoints: [],\n      hitObjects: [],\n      keyCount: 0,\n      svSegments: [],\n      svCumAreas: [],\n      combinedSegments: [],\n      combinedCumAreas: [],\n    };\n\n    let currentSection = \"\";\n\n    for (let line of lines) {\n      line = line.trim();\n      if (line.startsWith(\"[\") && line.endsWith(\"]\")) {\n        currentSection = line.slice(1, -1);\n        continue;\n      }\n      if (line === \"\" || line.startsWith(\"//\")) continue;\n\n      switch (currentSection) {\n        case \"General\":\n          this.parseKeyValue(line, beatmap.general);\n          break;\n        case \"Metadata\":\n          this.parseKeyValue(line, beatmap.metadata);\n          break;\n        case \"Difficulty\":\n          this.parseDifficulty(line, beatmap.difficulty);\n          break;\n        case \"TimingPoints\":\n          this.parseTimingPoint(line, beatmap.timingPoints);\n          break;\n        case \"HitObjects\":\n          this.parseHitObject(line, beatmap.hitObjects);\n          break;\n      }\n    }\n\n    // TPSV\n    const rawTP = beatmap.timingPoints.map((tp) => ({ ...tp }));\n\n    //  timingPoints SV\n    this.alignTimingPoints(beatmap.timingPoints);\n\n    // TPSV\n    beatmap.rawTimingPointsForSV = rawTP;\n\n    // \n    this.calculateMeasures(beatmap);\n\n    // \n    beatmap.keyCount = this.calculateKeyCount(beatmap.hitObjects);\n    if (beatmap.keyCount !== 4) {\n      beatmap.hitObjects = this.convertTo4Key(\n        beatmap.hitObjects,\n        beatmap.keyCount,\n      );\n      beatmap.keyCount = 4;\n    } else {\n      for (const obj of beatmap.hitObjects) {\n        obj.column = Math.floor((obj.x * 4) / 512);\n      }\n    }\n\n    // 1/81/8\n    if (beatmap.measures && beatmap.measures.length > 0) {\n      this.calculateKeyGroupsBySubMeasures(\n        beatmap.hitObjects,\n        beatmap.measures,\n        16, // 16\n      );\n    } else {\n      this.calculateKeyGroups(beatmap.hitObjects);\n    }\n\n    // SV\n    this.buildSVSegments(beatmap);\n    this.buildCombinedSegments(beatmap);\n\n    this.beatmap = beatmap;\n    return beatmap;\n  }\n\n  private parseKeyValue(line: string, target: Record<string, string>): void {\n    const [key, ...rest] = line.split(\":\");\n    if (!key) return;\n    const value = rest.join(\":\").trim();\n    if (value !== \"\") target[key.trim()] = value.trim();\n  }\n\n  private parseDifficulty(\n    line: string,\n    difficulty: Record<string, number | string>,\n  ): void {\n    const [key, ...rest] = line.split(\":\");\n    if (!key) return;\n    const raw = rest.join(\":\").trim();\n    const num = parseFloat(raw);\n    difficulty[key.trim()] = isNaN(num) ? raw : num;\n  }\n\n  private parseTimingPoint(line: string, timingPoints: TimingPoint[]): void {\n    const parts = line.split(\",\");\n    if (parts.length >= 2) {\n      const time = parseFloat(parts[0]);\n      const beatLength = parseFloat(parts[1]); // =(BPM), =(SV)\n      const meter = parseInt(parts[2]) || 4;\n      const uninherited = parts.length < 7 ? true : parts[6] === \"1\";\n      timingPoints.push({\n        time,\n        beatLength,\n        meter,\n        uninherited,\n      });\n    }\n  }\n\n  private parseHitObject(line: string, hitObjects: HitObject[]): void {\n    const parts = line.split(\",\");\n    if (parts.length >= 4) {\n      const x = parseInt(parts[0], 10);\n      const time = parseInt(parts[2], 10);\n      const type = parseInt(parts[3], 10);\n      const isLongNote = !!(type & 128);\n      const obj: HitObject = {\n        x,\n        time,\n        type,\n        isLongNote,\n        endTime: time,\n        column: 0,\n        keyGroup: 0,\n      };\n      if (isLongNote && parts.length >= 6) {\n        const endTimeStr = parts[5].split(\":\")[0];\n        obj.endTime = parseInt(endTimeStr, 10);\n      }\n      hitObjects.push(obj);\n    }\n  }\n}\n","// JSON - TypeScript\n\nimport type {\n  Beatmap,\n  TimingPoint,\n  HitObject,\n  SVSegment,\n} from \"./beatmapParser.js\";\nimport { BaseBeatmapParser } from \"./beatmapParser.js\";\n\n// JSON\nexport interface JSONBeatmapFormat {\n  formatVersion?: string;\n  metadata: {\n    title?: string;\n    titleUnicode?: string;\n    artist?: string;\n    artistUnicode?: string;\n    creator?: string;\n    version?: string;\n    source?: string;\n    tags?: string[];\n    beatmapId?: number;\n    beatmapSetId?: number;\n  };\n  general?: {\n    audioFilename?: string;\n    audioLeadIn?: number;\n    previewTime?: number;\n    countdown?: number;\n    sampleSet?: string;\n    stackLeniency?: number;\n    mode?: number;\n    letterboxInBreaks?: boolean;\n    useSkinSprites?: boolean;\n    overlayPosition?: string;\n  };\n  editor?: {\n    bookmarks?: number[];\n    distanceSpacing?: number;\n    beatDivisor?: number;\n    gridSize?: number;\n    timelineZoom?: number;\n  };\n  difficulty: {\n    hpDrainRate?: number;\n    circleSize?: number;\n    overallDifficulty?: number;\n    approachRate?: number;\n    sliderMultiplier?: number;\n    sliderTickRate?: number;\n  };\n  timing?: {\n    baseBPM?: number;\n    baseSV?: number;\n    points: Array<{\n      time: number;\n      beatLength: number;\n      meter?: number;\n      sampleSet?: number;\n      sampleIndex?: number;\n      volume?: number;\n      uninherited: boolean;\n      effects?: number;\n    }>;\n  };\n  objects: {\n    keyCount: number;\n    hitObjects: Array<{\n      id?: string;\n      type: \"circle\" | \"longNote\" | \"slider\";\n      time: number;\n      column: number;\n      x: number;\n      y?: number;\n      startTime?: number;\n      endTime?: number;\n      startX?: number;\n      startY?: number;\n      endX?: number;\n      endY?: number;\n      curveType?: string;\n      curvePoints?: Array<{ x: number; y: number }>;\n      slides?: number;\n      length?: number;\n      edgeSounds?: number[];\n      edgeSets?: number[][];\n      hitsound?: {\n        normalSet?: number;\n        additionSet?: number;\n        index?: number;\n        volume?: number;\n        filename?: string | null;\n      };\n      extras?: {\n        keyGroup?: number;\n        comboIndex?: number;\n        comboNumber?: number;\n      };\n    }>;\n    keyGroups?: Array<{\n      id: number;\n      color?: string;\n      objects?: string[];\n    }>;\n  };\n  events?: {\n    background?: {\n      filename?: string;\n      xOffset?: number;\n      yOffset?: number;\n    };\n    video?: {\n      filename?: string;\n      xOffset?: number;\n      yOffset?: number;\n    };\n    breakPeriods?: Array<{\n      startTime: number;\n      endTime: number;\n    }>;\n    storyboard?: {\n      layers?: any[];\n    };\n  };\n  colors?: {\n    comboColors?: Array<{ r: number; g: number; b: number }>;\n    sliderTrackColor?: { r: number; g: number; b: number; a?: number };\n    sliderBorderColor?: { r: number; g: number; b: number; a?: number };\n  };\n  calculated?: {\n    svSegments?: Array<{\n      start: number;\n      end: number;\n      sv: number;\n      bpm?: number;\n    }>;\n    svCumAreas?: number[];\n    combinedSegments?: Array<{\n      start: number;\n      end: number;\n      sv: number;\n      bpm?: number;\n      multiplier?: number;\n    }>;\n    combinedCumAreas?: number[];\n    measures?: number[];\n    maxCombo?: number;\n    totalObjects?: number;\n    duration?: number;\n    drainTime?: number;\n  };\n  custom?: {\n    \"4keySpecific\"?: {\n      scrollSpeed?: number;\n      judgementWindows?: {\n        perfect: number;\n        great: number;\n        good: number;\n        bad: number;\n        miss: number;\n      };\n      keyBindings?: string[];\n      skin?: string;\n      particleEffects?: boolean;\n    };\n    creatorInfo?: {\n      createdAt?: string;\n      updatedAt?: string;\n      toolsUsed?: string[];\n      tags?: string[];\n    };\n  };\n}\n\nexport class JSONBeatmapParser extends BaseBeatmapParser {\n  parse(content: string): Beatmap {\n    let jsonData: JSONBeatmapFormat;\n    try {\n      jsonData = JSON.parse(content);\n    } catch (error) {\n      throw new Error(`Invalid JSON format: ${error}`);\n    }\n\n    // \n    if (!jsonData.objects || !jsonData.objects.hitObjects) {\n      throw new Error(\"Missing required fields: objects.hitObjects\");\n    }\n\n    // Beatmap\n    const beatmap: Beatmap = {\n      metadata: this.convertMetadata(jsonData.metadata || {}),\n      general: this.convertGeneral(jsonData.general || {}),\n      difficulty: this.convertDifficulty(jsonData.difficulty || {}),\n      timingPoints: this.convertTimingPoints(jsonData.timing),\n      hitObjects: this.convertHitObjects(jsonData.objects.hitObjects),\n      keyCount: jsonData.objects.keyCount || 4,\n      svSegments: [],\n      svCumAreas: [],\n      combinedSegments: [],\n      combinedCumAreas: [],\n    };\n\n    // SV\n    if (jsonData.calculated?.svSegments && jsonData.calculated.svCumAreas) {\n      beatmap.svSegments = jsonData.calculated.svSegments;\n      beatmap.svCumAreas = jsonData.calculated.svCumAreas;\n    } else {\n      // SV\n      beatmap.rawTimingPointsForSV = [...beatmap.timingPoints];\n\n      // \n      this.alignTimingPoints(beatmap.timingPoints);\n\n      // SV\n      this.buildSVSegments(beatmap);\n    }\n\n    // \n    if (\n      jsonData.calculated?.combinedSegments &&\n      jsonData.calculated.combinedCumAreas\n    ) {\n      beatmap.combinedSegments = jsonData.calculated.combinedSegments;\n      beatmap.combinedCumAreas = jsonData.calculated.combinedCumAreas;\n    } else {\n      this.buildCombinedSegments(beatmap);\n    }\n\n    // \n    if (jsonData.calculated?.measures) {\n      beatmap.measures = jsonData.calculated.measures;\n    } else {\n      this.calculateMeasures(beatmap);\n    }\n\n    // 4\n    if (beatmap.keyCount !== 4) {\n      beatmap.hitObjects = this.convertTo4Key(\n        beatmap.hitObjects,\n        beatmap.keyCount,\n      );\n      beatmap.keyCount = 4;\n    } else {\n      // \n      for (const obj of beatmap.hitObjects) {\n        if (obj.column === undefined) {\n          obj.column = Math.floor((obj.x * 4) / 512);\n        }\n      }\n    }\n\n    // JSON\n    const hasKeyGroups =\n      jsonData.objects.keyGroups && jsonData.objects.keyGroups.length > 0;\n    if (!hasKeyGroups) {\n      // 1/81/8\n      if (beatmap.measures && beatmap.measures.length > 0) {\n        this.calculateKeyGroupsBySubMeasures(\n          beatmap.hitObjects,\n          beatmap.measures,\n          16, // 16\n        );\n      } else {\n        this.calculateKeyGroups(beatmap.hitObjects);\n      }\n    } else {\n      // JSON\n      this.applyKeyGroupsFromJSON(\n        beatmap.hitObjects,\n        jsonData.objects.keyGroups,\n      );\n    }\n\n    this.beatmap = beatmap;\n    return beatmap;\n  }\n\n  private convertMetadata(\n    jsonMetadata: JSONBeatmapFormat[\"metadata\"],\n  ): Record<string, string> {\n    const metadata: Record<string, string> = {};\n\n    if (jsonMetadata.title) metadata.Title = jsonMetadata.title;\n    if (jsonMetadata.titleUnicode)\n      metadata.TitleUnicode = jsonMetadata.titleUnicode;\n    if (jsonMetadata.artist) metadata.Artist = jsonMetadata.artist;\n    if (jsonMetadata.artistUnicode)\n      metadata.ArtistUnicode = jsonMetadata.artistUnicode;\n    if (jsonMetadata.creator) metadata.Creator = jsonMetadata.creator;\n    if (jsonMetadata.version) metadata.Version = jsonMetadata.version;\n    if (jsonMetadata.source) metadata.Source = jsonMetadata.source;\n    if (jsonMetadata.tags) metadata.Tags = jsonMetadata.tags.join(\" \");\n    if (jsonMetadata.beatmapId)\n      metadata.BeatmapID = jsonMetadata.beatmapId.toString();\n    if (jsonMetadata.beatmapSetId)\n      metadata.BeatmapSetID = jsonMetadata.beatmapSetId.toString();\n\n    return metadata;\n  }\n\n  private convertGeneral(\n    jsonGeneral: JSONBeatmapFormat[\"general\"] | undefined,\n  ): Record<string, string> {\n    const general: Record<string, string> = {};\n\n    if (!jsonGeneral) return general;\n\n    if (jsonGeneral.audioFilename)\n      general.AudioFilename = jsonGeneral.audioFilename;\n    if (jsonGeneral.audioLeadIn !== undefined)\n      general.AudioLeadIn = jsonGeneral.audioLeadIn.toString();\n    if (jsonGeneral.previewTime !== undefined)\n      general.PreviewTime = jsonGeneral.previewTime.toString();\n    if (jsonGeneral.countdown !== undefined)\n      general.Countdown = jsonGeneral.countdown.toString();\n    if (jsonGeneral.sampleSet) general.SampleSet = jsonGeneral.sampleSet;\n    if (jsonGeneral.stackLeniency !== undefined)\n      general.StackLeniency = jsonGeneral.stackLeniency.toString();\n    if (jsonGeneral.mode !== undefined)\n      general.Mode = jsonGeneral.mode.toString();\n    if (jsonGeneral.letterboxInBreaks !== undefined)\n      general.LetterboxInBreaks = jsonGeneral.letterboxInBreaks ? \"1\" : \"0\";\n    if (jsonGeneral.useSkinSprites !== undefined)\n      general.UseSkinSprites = jsonGeneral.useSkinSprites ? \"1\" : \"0\";\n    if (jsonGeneral.overlayPosition)\n      general.OverlayPosition = jsonGeneral.overlayPosition;\n\n    return general;\n  }\n\n  private convertDifficulty(\n    jsonDifficulty: JSONBeatmapFormat[\"difficulty\"],\n  ): Record<string, number | string> {\n    const difficulty: Record<string, number | string> = {};\n\n    if (jsonDifficulty.hpDrainRate !== undefined)\n      difficulty.HPDrainRate = jsonDifficulty.hpDrainRate;\n    if (jsonDifficulty.circleSize !== undefined)\n      difficulty.CircleSize = jsonDifficulty.circleSize;\n    if (jsonDifficulty.overallDifficulty !== undefined)\n      difficulty.OverallDifficulty = jsonDifficulty.overallDifficulty;\n    if (jsonDifficulty.approachRate !== undefined)\n      difficulty.ApproachRate = jsonDifficulty.approachRate;\n    if (jsonDifficulty.sliderMultiplier !== undefined)\n      difficulty.SliderMultiplier = jsonDifficulty.sliderMultiplier;\n    if (jsonDifficulty.sliderTickRate !== undefined)\n      difficulty.SliderTickRate = jsonDifficulty.sliderTickRate;\n\n    return difficulty;\n  }\n\n  private convertTimingPoints(\n    jsonPoints: JSONBeatmapFormat[\"timing\"] | undefined,\n  ): TimingPoint[] {\n    if (!jsonPoints || !jsonPoints.points) return [];\n    return jsonPoints.points.map((point) => ({\n      time: point.time,\n      beatLength: point.beatLength,\n      meter: point.meter || 4,\n      uninherited: point.uninherited,\n    }));\n  }\n\n  private convertHitObjects(\n    jsonObjects: JSONBeatmapFormat[\"objects\"][\"hitObjects\"],\n  ): HitObject[] {\n    return jsonObjects.map((obj) => {\n      const hitObject: HitObject = {\n        x: obj.x || 0,\n        time: obj.type === \"longNote\" ? obj.startTime || obj.time : obj.time,\n        type: this.getObjectType(obj.type),\n        isLongNote: obj.type === \"longNote\",\n        endTime: obj.type === \"longNote\" ? obj.endTime || obj.time : obj.time,\n        column: obj.column || 0,\n        keyGroup: obj.extras?.keyGroup || 0,\n      };\n\n      // endTime\n      if (obj.type === \"longNote\" && !obj.endTime) {\n        console.warn(\"Long note missing endTime, using time + 100ms\");\n        hitObject.endTime = hitObject.time + 100;\n      }\n\n      return hitObject;\n    });\n  }\n\n  private getObjectType(type: string): number {\n    switch (type) {\n      case \"circle\":\n        return 1;\n      case \"longNote\":\n        return 128; // LN\n      case \"slider\":\n        return 2;\n      default:\n        return 1; // \n    }\n  }\n\n  private applyKeyGroupsFromJSON(\n    hitObjects: HitObject[],\n    keyGroups: JSONBeatmapFormat[\"objects\"][\"keyGroups\"],\n  ): void {\n    if (!keyGroups) return;\n\n    // ID\n    const objectMap = new Map<string, HitObject>();\n    hitObjects.forEach((obj, index) => {\n      objectMap.set(`obj_${index}`, obj);\n    });\n\n    // \n    for (const group of keyGroups) {\n      if (group.objects) {\n        for (const objId of group.objects) {\n          const obj = objectMap.get(objId);\n          if (obj) {\n            obj.keyGroup = group.id;\n          }\n        }\n      }\n    }\n\n    // \n    let currentGroup = Math.max(...keyGroups.map((g) => g.id)) + 1;\n    for (const obj of hitObjects) {\n      if (obj.keyGroup === 0) {\n        obj.keyGroup = currentGroup++;\n      }\n    }\n  }\n}\n","//  - TypeScript\n\nimport type { IBeatmapParser, Beatmap } from \"./beatmapParser.js\";\nimport { OSUBeatmapParser } from \"./osuParser.js\";\nimport { JSONBeatmapParser } from \"./jsonParser.js\";\n\n/**\n * \n * \n */\nexport class BeatmapParserFactory {\n  /**\n   * \n   * @param content \n   * @returns \n   */\n  static createParser(content: string): IBeatmapParser {\n    const trimmedContent = content.trim();\n\n    // JSON\n    if (this.isJSONFormat(trimmedContent)) {\n      return new JSONBeatmapParser();\n    }\n\n    // OSU\n    if (this.isOSUFormat(trimmedContent)) {\n      return new OSUBeatmapParser();\n    }\n\n    // OSU\n    console.warn(\"OSU\");\n    return new OSUBeatmapParser();\n  }\n\n  /**\n   * JSON\n   * @param content \n   * @returns JSON\n   */\n  static isJSONFormat(content: string): boolean {\n    try {\n      //  { \n      if (!content.startsWith(\"{\")) {\n        return false;\n      }\n\n      // JSON\n      const parsed = JSON.parse(content);\n\n      // \n      if (!parsed || typeof parsed !== \"object\") {\n        return false;\n      }\n\n      // JSON\n      const hasFormatVersion = \"formatVersion\" in parsed;\n      const hasObjectsField =\n        \"objects\" in parsed &&\n        parsed.objects &&\n        typeof parsed.objects === \"object\" &&\n        \"hitObjects\" in parsed.objects;\n\n      return hasFormatVersion || hasObjectsField;\n    } catch (error) {\n      return false;\n    }\n  }\n\n  /**\n   * OSU\n   * @param content \n   * @returns OSU\n   */\n  static isOSUFormat(content: string): boolean {\n    // OSU\n    // 1.  [General][Metadata] \n    // 2.  osu file format v \n    // 3. \n\n    const lines = content.split(\"\\n\").slice(0, 10); // 10\n\n    // \n    const hasVersionLine = lines.some((line) =>\n      line.toLowerCase().includes(\"osu file format v\"),\n    );\n\n    // \n    const hasSectionMarkers = lines.some(\n      (line) => line.trim().startsWith(\"[\") && line.trim().endsWith(\"]\"),\n    );\n\n    // \n    const hasKeyValuePairs = lines.some((line) => {\n      const trimmed = line.trim();\n      return (\n        trimmed.includes(\":\") && !trimmed.startsWith(\"//\") && trimmed !== \"\"\n      );\n    });\n\n    return hasVersionLine || (hasSectionMarkers && hasKeyValuePairs);\n  }\n\n  /**\n   * \n   * @param filename \n   * @returns \n   */\n  static createParserByExtension(filename: string): IBeatmapParser {\n    const extension = filename.toLowerCase().split(\".\").pop();\n\n    switch (extension) {\n      case \"json\":\n      case \"4key\":\n      case \"4keyjson\":\n        return new JSONBeatmapParser();\n\n      case \"osu\":\n        return new OSUBeatmapParser();\n\n      case \"osz\":\n        // .osz OSU\n        console.warn(\n          \".osz files need to be extracted first, using OSU parser for internal .osu files\",\n        );\n        return new OSUBeatmapParser();\n\n      default:\n        console.warn(\n          `Unknown file extension: .${extension}, defaulting to OSU parser`,\n        );\n        return new OSUBeatmapParser();\n    }\n  }\n\n  /**\n   * \n   * @param content \n   * @returns \n   */\n  static parse(content: string): Beatmap {\n    const parser = this.createParser(content);\n    return parser.parse(content);\n  }\n\n  /**\n   * \n   * @param contents \n   * @returns \n   */\n  static parseAll(contents: string[]): Beatmap[] {\n    return contents.map((content) => this.parse(content));\n  }\n}\n\n/**\n * \n */\nexport function detectContentType(content: string): \"json\" | \"osu\" | \"unknown\" {\n  const trimmed = content.trim();\n\n  if (BeatmapParserFactory.isJSONFormat(trimmed)) {\n    return \"json\";\n  }\n\n  if (BeatmapParserFactory.isOSUFormat(trimmed)) {\n    return \"osu\";\n  }\n\n  return \"unknown\";\n}\n\n/**\n * \n */\nexport function getRecommendedExtension(content: string): string {\n  const type = detectContentType(content);\n\n  switch (type) {\n    case \"json\":\n      return \".4key.json\";\n    case \"osu\":\n      return \".osu\";\n    default:\n      return \".txt\";\n  }\n}\n\n// \nexport default BeatmapParserFactory;\n","//  - \n\ntype SoundData = {\n    buffer: AudioBuffer;\n    instances: AudioBufferSourceNode[];\n};\n\nexport class AudioManager {\n    private audio: HTMLAudioElement | null = null;\n    private audioContext: AudioContext | null = null;\n    private sourceNode: AudioBufferSourceNode | null = null;\n    public onEnded: (() => void) | null = null;\n    private isPlaying: boolean = false;\n    private startTime: number = 0;\n    private pauseTime: number = 0;\n    private playbackRate: number = 1.0;\n\n    // \n    private soundPool: Map<string, SoundData> = new Map();\n    private readonly poolSize: number = 10;\n\n    constructor() {\n        this.initAudioContext();\n    }\n\n    private initAudioContext(): void {\n        try {\n            this.audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\n        } catch (e) {\n            console.warn('Web Audio API not supported', e);\n        }\n    }\n\n    async loadAudio(audioBlob: Blob): Promise<HTMLAudioElement> {\n        return new Promise((resolve, reject) => {\n            const url = URL.createObjectURL(audioBlob);\n            this.audio = new Audio(url);\n            this.audio.volume = 0.26;\n\n            this.audio.addEventListener('loadeddata', () => {\n                resolve(this.audio!);\n            });\n\n            this.audio.addEventListener('error', reject);\n        });\n    }\n\n    // \n    async loadSound(name: string, url: string): Promise<void> {\n        if (!this.audioContext) return;\n\n        try {\n            const response = await fetch(url);\n            const arrayBuffer = await response.arrayBuffer();\n            const audioBuffer = await this.audioContext.decodeAudioData(arrayBuffer);\n\n            this.soundPool.set(name, {\n                buffer: audioBuffer,\n                instances: []\n            });\n\n\n        } catch (e) {\n            console.error(`Failed to load sound \"${name}\":`, e);\n        }\n    }\n\n    // \n    async playSound(name: string, volume: number = 1.0): Promise<void> {\n        if (!this.audioContext || !this.soundPool.has(name)) {\n            return;\n        }\n\n        //  AudioContext \n        if (this.audioContext.state === 'suspended') {\n            await this.audioContext.resume();\n        }\n\n        const soundData = this.soundPool.get(name)!;\n\n        //  Promise \n        return new Promise((resolve) => {\n            //  setTimeout \n            setTimeout(() => {\n                const source = this.audioContext!.createBufferSource();\n                source.buffer = soundData.buffer;\n\n                const gainNode = this.audioContext!.createGain();\n                gainNode.gain.value = volume;\n\n                source.connect(gainNode);\n                gainNode.connect(this.audioContext!.destination);\n\n                source.onended = () => {\n                    source.disconnect();\n                    gainNode.disconnect();\n                    resolve();\n                };\n\n                source.start(0);\n            }, 0);\n        });\n    }\n\n    // \n    playSound_nonBlocking(name: string, volume: number = 1.0): void {\n        this.playSound(name, volume).catch(e => {\n            console.warn(`Sound playback error: ${e}`);\n        });\n    }\n\n    play(startTime: number = 0): void {\n        if (this.audio) {\n            this.audio.currentTime = startTime;\n            this.audio.playbackRate = this.playbackRate;\n            this.audio.play();\n            this.isPlaying = true;\n            this.startTime = startTime;\n            this.audio.onended = () => {\n                this.isPlaying = false;\n                if (this.onEnded) this.onEnded();\n            };\n        }\n    }\n\n    pause(): void {\n        if (this.audio) {\n            this.audio.pause();\n            this.pauseTime = this.audio.currentTime;\n            this.isPlaying = false;\n        }\n    }\n\n    stop(): void {\n        if (this.audio) {\n            this.audio.pause();\n            this.audio.currentTime = 0;\n            this.isPlaying = false;\n            this.pauseTime = 0;\n        }\n    }\n\n    setPlaybackRate(rate: number): void {\n        this.playbackRate = rate;\n        if (this.audio) {\n            this.audio.playbackRate = rate;\n        }\n    }\n\n    getCurrentTime(): number {\n        return this.audio ? this.audio.currentTime * 1000 : 0;\n    }\n\n    getDuration(): number {\n        return this.audio ? this.audio.duration : 0;\n    }\n\n    getIsPlaying(): boolean {\n        return this.isPlaying;\n    }\n\n    // \n    dispose(): void {\n        this.soundPool.clear();\n        if (this.audioContext) {\n            this.audioContext.close();\n        }\n    }\n}\n","// @ts-nocheck\n//  -  Worker  - TypeScript\n\nimport type { Beatmap } from \"./beatmapParser.js\";\n\ninterface AmbientParticle {\n  x: number;\n  y: number;\n  r: number;\n  alpha: number;\n  vx: number;\n  vy: number;\n}\n\ninterface HitEffectParticle {\n  x: number;\n  y: number;\n  vx: number;\n  vy: number;\n  life: number;\n  decay: number;\n  size: number;\n  color: string;\n  isExplosion?: boolean;\n}\n\nexport class GameRenderer {\n  private canvas: HTMLCanvasElement;\n  private ctx: CanvasRenderingContext2D;\n  private offscreenCanvas: HTMLCanvasElement;\n  private offscreenCtx: CanvasRenderingContext2D;\n\n  private beatmap: Beatmap | null = null;\n  private currentTime: number = 0;\n  private scrollSpeed: number = 800;\n  private showSV: boolean = true;\n  private showKeyGroup: boolean = true;\n  private useBPMScaling: boolean = false;\n  private measureOffset: number = 0; // \n\n  private laneWidth: number = 120;\n  private laneCount: number = 4;\n  private judgmentLineY: number = 0;\n\n  private visibleLeadTime: number = 5000;\n  private visibleTrail: number = 46;\n\n  private bgImage: HTMLImageElement | null = null;\n  private bgReady: boolean = false;\n  private bgAlpha: number = 0.15;\n\n  private ambientParticles: AmbientParticle[] = [];\n  private hitEffects: HitEffectParticle[] = [];\n  private ambientCount: number = 160;\n\n  private pressedLanes: Set<number> = new Set();\n\n  private keyGroupColors: string[] = [\n    //new experimental keygroup color\n    // \"#FF6B6B\", // \n    // \"#81C784\", // \n    // \"#45B7D1\", // \n    // \"#FFB74D\", // \n    // \"#98D8C8\", // \n    // \"#F06292\", // \n    // \"#BB8FCE\", // \n    // \"#FFD54F\", // \n    // \"#4ECDC4\", // \n    // \"#E57373\", // \n    // \"#FFA07A\", // \n    // \"#64B5F6\", // \n    // \"#D4B85A\", // \n    // \"#7986CB\", // \n    // \"#85C1E2\", // \n    // \"#FF8A65\", // \n    // \"#BA68C8\", // \n    // \"#AED581\", // \n    // \"#4DB6AC\", // \n    // \"#FF9800\", // \n    // \"#4FC3F7\", // \n    // \"#9575CD\", // \n    // \"#4DD0E1\", // \n    // \"#A1887F\", // \n    // \"#90A4AE\", // \n    // \"#FFF176\", // \n    // \"#81D4FA\", // \n    // \"#CE93D8\", // \n    // \"#80CBC4\", // \n    // \"#9FA8DA\", // \n    // \"#F48FB1\", // \n    // \"#C5E1A5\", // \n    // \"#80DEEA\", // \n    // \"#FFCC80\", // \n    \"#FF6B6B\",\n    \"#4ECDC4\",\n    \"#45B7D1\",\n    \"#FFA07A\",\n    \"#98D8C8\",\n    \"#F7DC6F\",\n    \"#BB8FCE\",\n    \"#85C1E2\",\n  ];\n\n  private stats: {\n    score: number;\n    combo: number;\n    acc: number;\n    judgements: Record<string, number>;\n  } = { score: 0, combo: 0, acc: 100, judgements: {} };\n\n  private fps: number = 0;\n  private frameCount: number = 0;\n  private lastFpsUpdate: number = Date.now();\n\n  private particleWorker: Worker | null = null;\n\n  private _lastFrameTime: number = performance.now();\n  private _accum: number = 0;\n  private pendingTasks: any[] = [];\n\n  // \n  private disableVsync: boolean = false;\n  private renderLoopId: number | null = null;\n  private targetFPS: number = 360; // \n  private lastRenderTime: number = 0;\n  private renderAccumulator: number = 0;\n  private fixedTimeStep: number = 1 / 60; // \n  private isRendering: boolean = false;\n\n  private width: number = 0;\n  private height: number = 0;\n\n  constructor(canvas: HTMLCanvasElement) {\n    this.canvas = canvas;\n    this.ctx = canvas.getContext(\"2d\", { alpha: false })!;\n    this.offscreenCanvas = document.createElement(\"canvas\");\n    this.offscreenCtx = this.offscreenCanvas.getContext(\"2d\")!;\n\n    this.resizeCanvas();\n    window.addEventListener(\"resize\", () => this.resizeCanvas());\n\n    //  Worker\n    this.initWorker();\n\n    this._lastFrameTime = performance.now();\n    this._accum = 0;\n    this.pendingTasks = [];\n\n    // BPM\n    this.useBPMScaling = true;\n  }\n\n  private initWorker(): void {\n    try {\n      this.particleWorker = new Worker(\n        new URL(\"./particleWorker.ts\", import.meta.url),\n      );\n      this.particleWorker.onmessage = (e: MessageEvent) => {\n        const { type, data } = e.data;\n        switch (type) {\n          case \"ambientInit\":\n          case \"ambientUpdate\":\n            this.ambientParticles = data;\n            break;\n          case \"hitCreate\":\n          case \"hitUpdate\":\n            this.hitEffects = data;\n            break;\n        }\n      };\n\n      // \n      this.particleWorker.postMessage({\n        type: \"initAmbient\",\n        data: {\n          count: this.ambientCount,\n          width: this.width,\n          height: this.height,\n        },\n      });\n    } catch (e) {\n      console.warn(\"Worker initialization failed, using fallback\", e);\n      this.initAmbientParticles(); // \n    }\n  }\n\n  // \n  async createHitEffect(column: number, keyGroupColor: string): Promise<void> {\n    const totalWidth = this.laneWidth * this.laneCount;\n    const startX = Math.random() * 10 + (this.width - totalWidth) / 2;\n    const x = startX + column * this.laneWidth + this.laneWidth / 2;\n    const y = this.judgmentLineY;\n    // \n    const color = this.isValidColor(keyGroupColor) ? keyGroupColor : \"#FFFFFF\";\n    if (this.particleWorker) {\n      //  Worker\n      return new Promise((resolve) => {\n        this.particleWorker!.postMessage({\n          type: \"createHit\",\n          data: { x, y, color, laneWidth: this.laneWidth },\n        });\n        resolve();\n      });\n    } else {\n      // \n      return this.createHitEffectFallback(column, keyGroupColor);\n    }\n  }\n  // \n  private isValidColor(color: string | undefined | null): boolean {\n    if (!color || typeof color !== \"string\") {\n      return false;\n    }\n    // \n    const hexRegex = /^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/;\n    return hexRegex.test(color);\n  }\n  // \n  async createHitEffectFallback(\n    column: number,\n    keyGroupColor: string,\n  ): Promise<void> {\n    return new Promise((resolve) => {\n      setTimeout(() => {\n        const totalWidth = this.laneWidth * this.laneCount;\n        const startX = Math.random() * 10 + (this.width - totalWidth) / 2;\n        const x = startX + column * this.laneWidth + this.laneWidth / 2;\n        const y = this.judgmentLineY;\n        const color = keyGroupColor || \"#FFFFFF\";\n        const particleCount = 30;\n        for (let i = 0; i < particleCount; i++) {\n          const angle = -Math.PI / 2 + (Math.random() - 0.5) * (Math.PI / 2);\n          const base = 0.8;\n          const speed = base * Math.sqrt(Math.random());\n          const vx = Math.cos(angle) * speed * 0.8;\n          const vy = Math.sin(angle) * speed;\n          this.hitEffects.push({\n            x,\n            y,\n            vx,\n            vy,\n            life: 1.5,\n            decay: 0.02 + Math.random() * 0.02,\n            size: this.laneWidth / 2 - 5 + Math.random() * 7,\n            color,\n          });\n        }\n        this.hitEffects.push({\n          x,\n          y,\n          vx: -0.2,\n          vy: 0,\n          life: 10,\n          decay: 0.6,\n          size: Math.random() * 10,\n          color,\n          isExplosion: true,\n        });\n        resolve();\n      }, 0);\n    });\n  }\n\n  resizeCanvas(): void {\n    const rect = this.canvas.getBoundingClientRect();\n    const dpr = window.devicePixelRatio || 1;\n    this.canvas.width = rect.width * dpr;\n    this.canvas.height = rect.height * dpr;\n    this.canvas.style.width = rect.width + \"px\";\n    this.canvas.style.height = rect.height + \"px\";\n    this.offscreenCanvas.width = this.canvas.width;\n    this.offscreenCanvas.height = this.canvas.height;\n    this.ctx.setTransform(1, 0, 0, 1, 0, 0);\n    this.ctx.scale(dpr, dpr);\n    this.offscreenCtx.setTransform(1, 0, 0, 1, 0, 0);\n    this.offscreenCtx.scale(dpr, dpr);\n    this.width = rect.width;\n    this.height = rect.height;\n    this.judgmentLineY = this.height - 100;\n  }\n\n  setBeatmap(beatmap: Beatmap): void {\n    this.beatmap = beatmap;\n  }\n\n  // \n  setMeasureOffset(offset: number): void {\n    this.measureOffset = offset;\n  }\n\n  // \n  getMeasureOffset(): number {\n    return this.measureOffset;\n  }\n\n  setScrollSpeed(speed: number): void {\n    this.scrollSpeed = Math.max(200, speed * 40);\n  }\n\n  setShowSV(show: boolean): void {\n    this.showSV = show;\n  }\n\n  setShowKeyGroup(show: boolean): void {\n    this.showKeyGroup = show;\n  }\n\n  setUseBPMScaling(use: boolean): void {\n    this.useBPMScaling = use;\n  }\n\n  setStats(stats: any): void {\n    this.stats = stats;\n  }\n\n  setPressedLanes(set: Set<number>): void {\n    this.pressedLanes = new Set(set);\n  }\n\n  async setBackgroundImageBlob(blob: Blob | null): Promise<void> {\n    if (!blob) {\n      this.bgImage = null;\n      this.bgReady = false;\n      return;\n    }\n    const url = URL.createObjectURL(blob);\n    await this.setBackgroundImageURL(url);\n  }\n\n  setBackgroundImageURL(url: string): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const img = new Image();\n      img.onload = () => {\n        this.bgImage = img;\n        this.bgReady = true;\n        resolve();\n      };\n      img.onerror = reject;\n      img.src = url;\n    });\n  }\n\n  svAreaAt(t: number): number {\n    const segs = this.beatmap?.svSegments || [];\n    const areas = this.beatmap?.svCumAreas || [];\n    if (!segs.length) return t;\n    let idx = 0,\n      lo = 0,\n      hi = segs.length - 1;\n    while (lo <= hi) {\n      const mid = (lo + hi) >> 1;\n      const s = segs[mid];\n      if (t < s.start) hi = mid - 1;\n      else if (s.end !== Infinity && t >= s.end) lo = mid + 1;\n      else {\n        idx = mid;\n        break;\n      }\n    }\n    const seg = segs[idx];\n    const base = areas[idx] || 0;\n    const end = seg.end === Infinity ? t : seg.end;\n    const clampedT = Math.max(seg.start, Math.min(t, end));\n    return base + seg.sv * (clampedT - seg.start);\n  }\n\n  // BPM+SVms * multiplier\n  combinedAreaAt(t: number): number {\n    const segs = this.beatmap?.combinedSegments || [];\n    const areas = this.beatmap?.combinedCumAreas || [];\n    if (!segs.length) return t;\n    let idx = 0,\n      lo = 0,\n      hi = segs.length - 1;\n    while (lo <= hi) {\n      const mid = (lo + hi) >> 1;\n      const s = segs[mid];\n      if (t < s.start) hi = mid - 1;\n      else if (s.end !== Infinity && t >= s.end) lo = mid + 1;\n      else {\n        idx = mid;\n        break;\n      }\n    }\n    const seg = segs[idx];\n    const base = areas[idx] || 0;\n    const end = seg.end === Infinity ? t : seg.end;\n    const clampedT = Math.max(seg.start, Math.min(t, end));\n    return base + seg.sv * (clampedT - seg.start);\n  }\n\n  noteYAt(time: number): number {\n    const k = this.scrollSpeed / 1000;\n    if (\n      !this.showSV ||\n      (!this.beatmap?.svSegments?.length &&\n        !this.beatmap?.combinedSegments?.length)\n    ) {\n      const dt = time - this.currentTime;\n      return this.judgmentLineY - k * dt;\n    }\n    // BPM+SVSV\n    const areaFunc = this.useBPMScaling ? this.combinedAreaAt : this.svAreaAt;\n    const aNote = areaFunc.call(this, time);\n    const aNow = areaFunc.call(this, this.currentTime);\n    return this.judgmentLineY - k * (aNote - aNow);\n  }\n\n  initAmbientParticles(): void {\n    this.ambientParticles = [];\n    for (let i = 0; i < this.ambientCount; i++) {\n      this.ambientParticles.push(this.makeAmbientParticle());\n    }\n  }\n\n  makeAmbientParticle(): AmbientParticle {\n    return {\n      x: Math.random() * this.width,\n      y: Math.random() * this.height,\n      r: 1.5 + Math.random() * 2.5,\n      alpha: 0.1 + Math.random() * 0.15,\n      vx: (Math.random() - 0.5) * 0.15,\n      vy: -0.05 - Math.random() * 0.35,\n    };\n  }\n\n  updateAmbientParticles(): void {\n    if (this.particleWorker) {\n      //  Worker \n      this.particleWorker.postMessage({\n        type: \"updateAmbient\",\n        data: { width: this.width, height: this.height },\n      });\n    } else {\n      // \n      for (const p of this.ambientParticles) {\n        p.x += p.vx;\n        p.y += p.vy;\n        if (p.y < -10) {\n          p.x = Math.random() * this.width;\n          p.y = this.height + 10;\n          p.vx = (Math.random() - 0.5) * 0.15;\n          p.vy = -0.05 - Math.random() * 0.15;\n          p.r = 1.5 + Math.random() * 2.5;\n          p.alpha = 0.1 + Math.random() * 0.15;\n        }\n        if (p.x < -10 || p.x > this.width + 10) {\n          p.vx *= -1;\n        }\n      }\n    }\n  }\n\n  drawAmbientParticles(): void {\n    // \n    this.ctx.save();\n    this.ctx.fillStyle = \"red\";\n    this.ctx.globalAlpha = 0.5;\n    this.ctx.fillRect(10, 10, 50, 50);\n    this.ctx.restore();\n    if (this.ambientParticles.length === 0) {\n      console.warn(\"WARNING: ambientParticles array is empty!\");\n      // \n      this.ambientParticles = [\n        {\n          x: this.width * 0.25,\n          y: this.height * 0.25,\n          r: 3,\n          alpha: 0.5,\n          vx: 0,\n          vy: 0,\n        },\n        {\n          x: this.width * 0.5,\n          y: this.height * 0.5,\n          r: 3,\n          alpha: 0.5,\n          vx: 0,\n          vy: 0,\n        },\n        {\n          x: this.width * 0.75,\n          y: this.height * 0.75,\n          r: 3,\n          alpha: 0.5,\n          vx: 0,\n          vy: 0,\n        },\n      ];\n    }\n    let drawnCount = 0;\n    for (const p of this.ambientParticles) {\n      if (!p || typeof p.x !== \"number\" || typeof p.y !== \"number\") {\n        console.warn(\"Invalid particle data:\", p);\n        continue;\n      }\n      this.ctx.fillStyle = `rgba(255,255,255,${p.alpha})`;\n      this.ctx.beginPath();\n      this.ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);\n      this.ctx.fill();\n      drawnCount++;\n    }\n  }\n\n  async render(currentTime: number): Promise<void> {\n    this.currentTime = currentTime;\n\n    // \n    if (this.disableVsync && this.isRendering) {\n      return;\n    }\n\n    this.drawBackgroundBase();\n    this.drawAmbientParticles();\n    this.drawBlurOverlay();\n    this.drawLanes();\n    this.drawHitObjects();\n    this.drawMeasures();\n    this.drawHitEffects();\n\n    const now = performance.now();\n    let dt = (now - this._lastFrameTime) / 1000;\n    this._lastFrameTime = now;\n    dt = Math.min(dt, 0.05);\n    this._accum += dt;\n    const step = 1 / 100;\n    while (this._accum >= step) {\n      await this.updateHitEffects();\n      await this.updateAmbientParticles();\n      this._accum -= step;\n    }\n\n    this.drawJudgmentLine();\n    this.drawHUD();\n    this.updateFPS();\n  }\n\n  updateHitEffects(): void {\n    if (this.particleWorker) {\n      //  Worker \n      this.particleWorker.postMessage({\n        type: \"updateHit\",\n        data: { height: this.height },\n      });\n    } else {\n      // \n      const next: HitEffectParticle[] = [];\n      for (const e of this.hitEffects) {\n        e.x += e.vx;\n        e.y += e.vy;\n        e.vy += 0.05;\n        e.life -= e.decay;\n        if (e.isExplosion) e.size *= 0.9;\n        else e.size *= 0.93;\n        if (e.life > 0 && e.y > 30 && e.y < this.height + 30) {\n          next.push(e);\n        }\n      }\n      this.hitEffects = next;\n    }\n  }\n\n  drawHitEffects(): void {\n    if (this.hitEffects.length === 0) {\n      return;\n    }\n    let drawnCount = 0;\n    for (const e of this.hitEffects) {\n      if (!e || typeof e.x !== \"number\" || typeof e.y !== \"number\") {\n        console.warn(\"Invalid hit effect data:\", e);\n        continue;\n      }\n      if (e.isExplosion) {\n        const g = this.ctx.createRadialGradient(\n          e.x,\n          e.y,\n          100,\n          e.x,\n          e.y,\n          e.size,\n        );\n        g.addColorStop(0, this.setAlpha(e.color, e.life * 0.6));\n        g.addColorStop(1, this.setAlpha(e.color, 0));\n        this.ctx.fillStyle = g;\n        this.ctx.beginPath();\n        this.ctx.arc(e.x, e.y, e.size, 0, Math.PI * 2);\n        this.ctx.fill();\n      } else {\n        this.ctx.fillStyle = this.setAlpha(e.color, e.life);\n        this.ctx.beginPath();\n        this.ctx.arc(e.x, e.y, e.size, 0, Math.PI * 2);\n        this.ctx.fill();\n      }\n      drawnCount++;\n    }\n  }\n\n  drawBackgroundBase(): void {\n    const g = this.ctx.createLinearGradient(0, 0, 0, this.height);\n    g.addColorStop(0, \"#0f0f1a\");\n    g.addColorStop(1, \"#0b0b16\");\n    this.ctx.fillStyle = g;\n    this.ctx.fillRect(0, 0, this.width, this.height);\n    if (this.bgReady && this.bgImage) {\n      const img = this.bgImage;\n      const iw = img.width,\n        ih = img.height;\n      const scale = Math.max(this.width / iw, this.height / ih);\n      const drawW = iw * scale,\n        drawH = ih * scale;\n      const dx = (this.width - drawW) / 2;\n      const dy = (this.height - drawH) / 2;\n      this.ctx.globalAlpha = this.bgAlpha;\n      this.ctx.drawImage(img, dx, dy, drawW, drawH);\n      this.ctx.globalAlpha = 1.0;\n    }\n  }\n\n  drawBlurOverlay(): void {\n    this.ctx.save();\n    this.ctx.filter = \"blur(4px)\";\n    const haze = this.ctx.createLinearGradient(0, 0, 0, this.height);\n    haze.addColorStop(0, \"rgba(0,0,0,0.08)\");\n    haze.addColorStop(1, \"rgba(0,0,0,0.18)\");\n    this.ctx.fillStyle = haze;\n    this.ctx.fillRect(0, 0, this.width, this.height);\n    this.ctx.restore();\n  }\n\n  drawLanes(): void {\n    const totalWidth = this.laneWidth * this.laneCount;\n    const startX = (this.width - totalWidth) / 2;\n    this.ctx.fillStyle = \"rgba(255,255,255,0.05)\";\n    for (let i = 0; i < this.laneCount; i += 2) {\n      this.ctx.fillRect(\n        startX + i * this.laneWidth,\n        0,\n        this.laneWidth,\n        this.height,\n      );\n    }\n    this.ctx.strokeStyle = \"rgba(255,255,255,0.3)\";\n    this.ctx.lineWidth = 2;\n    for (let i = 0; i <= this.laneCount; i++) {\n      const x = startX + i * this.laneWidth;\n      this.ctx.beginPath();\n      this.ctx.moveTo(x, 0);\n      this.ctx.lineTo(x, this.height);\n      this.ctx.stroke();\n    }\n    for (let i = 0; i < this.laneCount; i++) {\n      if (this.pressedLanes.has(i)) {\n        const x = startX + i * this.laneWidth;\n        this.ctx.fillStyle = \"rgba(255,255,255,0.08)\";\n        this.ctx.fillRect(x, this.judgmentLineY - 80, this.laneWidth, 160);\n      }\n    }\n  }\n\n  drawHitObjects(): void {\n    if (!this.beatmap || !this.beatmap.hitObjects) return;\n    const objs = this.beatmap.hitObjects;\n    const totalWidth = this.laneWidth * this.laneCount;\n    const startX = (this.width - totalWidth) / 2;\n    const noteWidth = this.laneWidth - 10;\n    const noteHeight = 20;\n    const fadeEarly = 150;\n\n    this.ctx.save();\n    this.ctx.beginPath();\n    this.ctx.rect(0, 14, this.width, this.judgmentLineY);\n    this.ctx.clip();\n\n    const calcAlpha = (hitTime: number): number => {\n      const timeToHit = hitTime - this.currentTime;\n      let alpha: number;\n      if (timeToHit <= fadeEarly) {\n        const fadeProgress =\n          (fadeEarly - timeToHit) / (fadeEarly + this.visibleTrail);\n        alpha = 1 - Math.min(1, fadeProgress);\n      } else {\n        alpha = 1;\n      }\n      return Math.pow(alpha, 0.5);\n    };\n\n    for (const obj of objs) {\n      const lastTime = obj.isLongNote ? obj.endTime : obj.time;\n      if (lastTime < this.currentTime - this.visibleTrail) continue;\n      if (obj.time > this.currentTime + this.visibleLeadTime) continue;\n\n      const x = startX + obj.column * this.laneWidth;\n\n      //  keyGroup \n      if (typeof obj.keyGroup === \"undefined\") {\n        console.warn(\"drawHitObjects: obj.keyGroup is undefined\", obj);\n      }\n\n      const color =\n        this.showKeyGroup &&\n        this.keyGroupColors &&\n        this.keyGroupColors.length > 0\n          ? this.keyGroupColors[\n              Math.abs(obj.keyGroup || 0) % this.keyGroupColors.length\n            ]\n          : \"#FFFFFF\";\n\n      // \n      if (!color || typeof color !== \"string\") {\n        console.error(\"drawHitObjects: Invalid color calculated\", {\n          showKeyGroup: this.showKeyGroup,\n          keyGroupColors: this.keyGroupColors,\n          keyGroupColorsLength: this.keyGroupColors?.length,\n          objKeyGroup: obj.keyGroup,\n          calculatedColor: color,\n        });\n      }\n\n      if (obj.isLongNote) {\n        const headY = this.noteYAt(obj.time);\n        const tailY = this.noteYAt(obj.endTime);\n        const visibleHeadY = Math.min(headY, this.judgmentLineY);\n        const visibleTailY = Math.min(tailY, this.judgmentLineY);\n        const bodyTop = Math.max(Math.min(visibleHeadY, visibleTailY), 0);\n        const bodyBottom = Math.min(\n          Math.max(visibleHeadY, visibleTailY),\n          this.judgmentLineY,\n        );\n        const bodyLen = Math.max(0, bodyBottom - bodyTop);\n        if (bodyLen > 0) {\n          const grad = this.ctx.createLinearGradient(\n            x + 5,\n            bodyTop,\n            x + 5,\n            bodyBottom,\n          );\n          grad.addColorStop(0, this.setAlpha(color, 0.35));\n          grad.addColorStop(1, this.setAlpha(color, 0.6));\n          this.ctx.fillStyle = grad;\n          this.ctx.fillRect(x + 5, bodyTop, noteWidth, bodyLen);\n          this.ctx.strokeStyle = this.setAlpha(color, 0.9);\n          this.ctx.lineWidth = 2;\n          this.ctx.strokeRect(x + 5, bodyTop, noteWidth, bodyLen);\n        }\n        if (headY >= 0 && headY < this.judgmentLineY) {\n          this.drawNoteRect(\n            x,\n            headY,\n            noteWidth,\n            noteHeight,\n            color,\n            calcAlpha(obj.time),\n          );\n        }\n        if (tailY >= 0 && tailY < this.judgmentLineY) {\n          this.drawNoteRect(\n            x,\n            tailY,\n            noteWidth,\n            noteHeight * 0.3,\n            this.adjustBrightness(color, -20),\n            calcAlpha(obj.endTime),\n          );\n        }\n      } else {\n        const y = this.noteYAt(obj.time);\n        if (y < 0 || y > this.judgmentLineY) continue;\n        this.drawNoteRect(\n          x,\n          y,\n          noteWidth,\n          noteHeight,\n          color,\n          calcAlpha(obj.time),\n        );\n      }\n    }\n    this.ctx.restore();\n  }\n\n  drawNoteRect(\n    x: number,\n    y: number,\n    w: number,\n    h: number,\n    color: string,\n    alphaFactor: number = 1.0,\n  ): void {\n    const distance = Math.abs(y - this.judgmentLineY);\n    const baseAlpha = Math.max(0.35, 1 - (distance / this.height) * 0.5);\n    const alpha = Math.max(0, Math.min(1, baseAlpha * alphaFactor));\n    this.ctx.shadowBlur = 10;\n    this.ctx.shadowColor = color;\n    const grad = this.ctx.createLinearGradient(x, y - h / 2, x, y + h / 2);\n    grad.addColorStop(0, this.setAlpha(color, alpha));\n    grad.addColorStop(\n      1,\n      this.setAlpha(this.adjustBrightness(color, -30), alpha),\n    );\n    this.ctx.fillStyle = grad;\n    this.ctx.fillRect(x + 5, y - h / 2, w, h);\n    this.ctx.strokeStyle = this.setAlpha(\n      this.adjustBrightness(color, 40),\n      alpha,\n    );\n    this.ctx.lineWidth = 2;\n    this.ctx.strokeRect(x + 5, y - h / 2, w, h);\n    this.ctx.shadowBlur = 0;\n  }\n\n  drawJudgmentLine(): void {\n    const totalWidth = this.laneWidth * this.laneCount;\n    const startX = (this.width - totalWidth) / 2;\n    this.ctx.shadowBlur = 12;\n    this.ctx.shadowColor = \"#FFD700\";\n    const gradient = this.ctx.createLinearGradient(\n      startX,\n      0,\n      startX + totalWidth,\n      0,\n    );\n    gradient.addColorStop(0, \"rgba(255,215,0,0.5)\");\n    gradient.addColorStop(0.5, \"rgba(255,215,0,1)\");\n    gradient.addColorStop(1, \"rgba(255,215,0,0.5)\");\n    this.ctx.strokeStyle = gradient;\n    this.ctx.lineWidth = 4;\n    this.ctx.beginPath();\n    this.ctx.moveTo(startX - 10, this.judgmentLineY);\n    this.ctx.lineTo(startX + totalWidth + 10, this.judgmentLineY);\n    this.ctx.stroke();\n    this.ctx.shadowBlur = 0;\n  }\n\n  drawHUD(): void {\n    const pad = 10;\n    this.ctx.fillStyle = \"rgba(0,0,0,0.5)\";\n    this.ctx.fillRect(pad, pad, 220, 100);\n    this.ctx.fillStyle = \"#FFF\";\n    this.ctx.font = \"14px monospace\";\n    this.ctx.fillText(\n      `Time: ${(this.currentTime / 1000).toFixed(2)}s`,\n      pad + 10,\n      pad + 25,\n    );\n    this.ctx.fillText(`FPS: ${this.fps}`, pad + 10, pad + 45);\n    this.ctx.fillText(`Combo: ${this.stats.combo || 0}`, pad + 110, pad + 25);\n    this.ctx.fillText(`Score: ${this.stats.score || 0}`, pad + 110, pad + 45);\n    this.ctx.fillText(\n      `Acc: ${(this.stats.acc || 100).toFixed(2)}%`,\n      pad + 110,\n      pad + 65,\n    );\n  }\n\n  updateFPS(): void {\n    this.frameCount++;\n    const now = Date.now();\n    if (now - this.lastFpsUpdate >= 1000) {\n      this.fps = this.frameCount;\n      this.frameCount = 0;\n      this.lastFpsUpdate = now;\n    }\n  }\n\n  adjustBrightness(color: string, amount: number): string {\n    // colorundefined\n    if (!color || typeof color !== \"string\") {\n      console.warn(\n        \"adjustBrightness: Invalid color provided, using default white\",\n        color,\n      );\n      return \"#FFFFFF\";\n    }\n\n    const hex = color.replace(\"#\", \"\");\n\n    // hex6\n    if (hex.length !== 6) {\n      console.warn(\n        \"adjustBrightness: Invalid hex color length, using default white\",\n        color,\n      );\n      return \"#FFFFFF\";\n    }\n\n    const r = Math.max(\n      0,\n      Math.min(255, parseInt(hex.substr(0, 2), 16) + amount),\n    );\n    const g = Math.max(\n      0,\n      Math.min(255, parseInt(hex.substr(2, 2), 16) + amount),\n    );\n    const b = Math.max(\n      0,\n      Math.min(255, parseInt(hex.substr(4, 2), 16) + amount),\n    );\n    return `#${r.toString(16).padStart(2, \"0\")}${g.toString(16).padStart(2, \"0\")}${b.toString(16).padStart(2, \"0\")}`;\n  }\n\n  setAlpha(color: string, alpha: number): string {\n    // colorundefined\n    if (!color || typeof color !== \"string\") {\n      console.warn(\n        \"setAlpha: Invalid color provided, using default white. Color was:\",\n        color,\n        \"Stack trace:\",\n        new Error().stack,\n      );\n      return `rgba(255,255,255,${alpha})`;\n    }\n\n    const hex = color.replace(\"#\", \"\");\n    // hex6\n    if (hex.length !== 6) {\n      console.warn(\n        \"setAlpha: Invalid hex color length, using default white. Color was:\",\n        color,\n        \"Hex length:\",\n        hex.length,\n      );\n      return `rgba(255,255,255,${alpha})`;\n    }\n\n    const r = parseInt(hex.substr(0, 2), 16);\n    const g = parseInt(hex.substr(2, 2), 16);\n    const b = parseInt(hex.substr(4, 2), 16);\n\n    // \n    if (isNaN(r) || isNaN(g) || isNaN(b)) {\n      console.warn(\n        \"setAlpha: Failed to parse color, using default white. Color was:\",\n        color,\n        \"Hex:\",\n        hex,\n      );\n      return `rgba(255,255,255,${alpha})`;\n    }\n\n    return `rgba(${r},${g},${b},${alpha})`;\n  }\n\n  drawMeasures(): void {\n    if (!this.beatmap || !this.beatmap.measures) return;\n    const totalWidth = this.laneWidth * this.laneCount;\n    const startX = (this.width - totalWidth) / 2;\n    this.ctx.strokeStyle = \"rgba(134,156,232,0.71)\";\n    this.ctx.lineWidth = 1;\n    for (const measureTime of this.beatmap.measures) {\n      // offset\n      const adjustedMeasureTime = measureTime + this.measureOffset;\n      const y = this.noteYAt(adjustedMeasureTime);\n      if (y > this.judgmentLineY) continue;\n      this.ctx.beginPath();\n      this.ctx.moveTo(startX, y);\n      this.ctx.lineTo(startX + totalWidth, y);\n      this.ctx.stroke();\n    }\n  }\n\n  clearHitEffects(): void {\n    this.hitEffects = [];\n    if (this.particleWorker) {\n      this.particleWorker.postMessage({\n        type: \"clearHit\",\n      });\n    }\n  }\n\n  dispose(): void {\n    if (this.particleWorker) {\n      this.particleWorker.terminate();\n    }\n    this.stopIndependentRenderLoop();\n  }\n\n  // \n  setDisableVsync(enabled: boolean): void {\n    if (this.disableVsync === enabled) return;\n\n    this.disableVsync = enabled;\n    if (enabled) {\n      // \n      this.startIndependentRenderLoop();\n    } else {\n      // render\n      this.stopIndependentRenderLoop();\n    }\n  }\n\n  // \n  startIndependentRenderLoop(): void {\n    if (this.isRendering || this.renderLoopId !== null) return;\n\n    this.isRendering = true;\n    this.lastRenderTime = performance.now();\n    this.renderAccumulator = 0;\n\n    const renderLoop = () => {\n      if (!this.isRendering) return;\n\n      const currentTime = performance.now();\n      const deltaTime = (currentTime - this.lastRenderTime) / 1000;\n      this.lastRenderTime = currentTime;\n\n      // deltaTime\n      const fixedDeltaTime = Math.min(deltaTime, 0.1);\n\n      // \n      this.renderAccumulator += fixedDeltaTime;\n\n      // \n      while (this.renderAccumulator >= this.fixedTimeStep) {\n        this.updateAmbientParticles();\n        this.updateHitEffects();\n        this.renderAccumulator -= this.fixedTimeStep;\n      }\n\n      // \n      this.renderFrame();\n\n      // \n      const targetFrameTime = 1000 / this.targetFPS;\n      const elapsed = performance.now() - currentTime;\n\n      if (elapsed >= targetFrameTime) {\n        // \n        Promise.resolve().then(() => {\n          if (this.isRendering) {\n            this.renderLoopId = requestAnimationFrame(renderLoop);\n          }\n        });\n      } else {\n        // requestAnimationFrame\n        this.renderLoopId = requestAnimationFrame(renderLoop);\n      }\n    };\n\n    // \n    renderLoop();\n  }\n\n  // \n  stopIndependentRenderLoop(): void {\n    this.isRendering = false;\n    if (this.renderLoopId !== null) {\n      cancelAnimationFrame(this.renderLoopId);\n      this.renderLoopId = null;\n    }\n  }\n\n  // \n  private renderFrame(): void {\n    // \n    this.ctx.save();\n\n    // \n    this.ctx.clearRect(0, 0, this.width, this.height);\n\n    // \n    this.drawBackgroundBase();\n    this.drawAmbientParticles();\n    this.drawBlurOverlay();\n    this.drawLanes();\n\n    // \n    this.drawHitObjects();\n\n    this.drawMeasures();\n    this.drawHitEffects();\n    this.drawJudgmentLine();\n    this.drawHUD();\n    this.updateFPS();\n\n    // \n    this.ctx.restore();\n  }\n\n  // \n  private drawHitObjectsWithInterpolation(alpha: number): void {\n    if (!this.beatmap) return;\n\n    const objs = this.beatmap.hitObjects;\n    const totalWidth = this.laneWidth * this.laneCount;\n    const startX = (this.width - totalWidth) / 2;\n    const noteWidth = this.laneWidth - 4;\n    const noteHeight = 24;\n    const fadeEarly = 200;\n\n    // \n    const interpolatedTime = this.currentTime + (alpha * 1000) / 60;\n\n    for (const obj of objs) {\n      const lastTime = obj.isLongNote ? obj.endTime : obj.time;\n      if (lastTime < interpolatedTime - this.visibleTrail) continue;\n      if (obj.time > interpolatedTime + this.visibleLeadTime) continue;\n\n      const x = startX + obj.column * this.laneWidth;\n      const color =\n        this.showKeyGroup &&\n        this.keyGroupColors &&\n        this.keyGroupColors.length > 0\n          ? this.keyGroupColors[\n              Math.abs(obj.keyGroup || 0) % this.keyGroupColors.length\n            ]\n          : \"#FFFFFF\";\n\n      if (obj.isLongNote) {\n        const headY = this.noteYAtWithInterpolation(obj.time, alpha);\n        const tailY = this.noteYAtWithInterpolation(obj.endTime, alpha);\n\n        // \n        const bodyTop = Math.min(headY, tailY);\n        const bodyBottom = Math.max(headY, tailY);\n        const bodyLen = Math.max(2, bodyBottom - bodyTop);\n\n        // \n        const grad = this.ctx.createLinearGradient(x, bodyTop, x, bodyBottom);\n        grad.addColorStop(0, this.adjustBrightness(color, 1.4));\n        grad.addColorStop(0.5, color);\n        grad.addColorStop(1, this.adjustBrightness(color, 0.6));\n\n        this.ctx.fillStyle = grad;\n        this.ctx.fillRect(x + 2, bodyTop, noteWidth, bodyLen);\n\n        // \n        this.drawNoteRect(headY, x, noteWidth, noteHeight, color, true);\n\n        // \n        this.drawNoteRect(tailY, x, noteWidth, noteHeight, color, false);\n      } else {\n        const y = this.noteYAtWithInterpolation(obj.time, alpha);\n        this.drawNoteRect(y, x, noteWidth, noteHeight, color, false);\n      }\n    }\n  }\n\n  // Y\n  private noteYAtWithInterpolation(time: number, alpha: number): number {\n    const interpolatedTime = this.currentTime + (alpha * 1000) / 60;\n    const k = this.scrollSpeed / 1000;\n\n    if (\n      !this.showSV ||\n      (!this.beatmap?.svSegments?.length &&\n        !this.beatmap?.combinedSegments?.length)\n    ) {\n      const dt = time - interpolatedTime;\n      return this.judgmentLineY - k * dt;\n    }\n\n    // BPM+SVSV\n    const areaFunc = this.useBPMScaling ? this.combinedAreaAt : this.svAreaAt;\n    const aNote = areaFunc.call(this, time);\n    const aNow = areaFunc.call(this, interpolatedTime);\n    return this.judgmentLineY - k * (aNote - aNow);\n  }\n\n  // \n  setTargetFPS(fps: number): void {\n    this.targetFPS = Math.max(30, Math.min(500, fps)); // 30-500fps\n  }\n}\n","import { OSZParser } from \"./oszParser.js\";\nimport { PCZParser } from \"./pczParser.js\";\nimport type { Beatmap, HitObject } from \"./beatmapParser.js\";\nimport { BeatmapParserFactory } from \"./parserFactory.js\";\nimport { AudioManager } from \"./audioManager.js\";\nimport { GameRenderer } from \"./gameRenderer.js\";\n\ntype JudgementType = \"Perfect\" | \"Great\" | \"Good\" | \"Bad\" | \"Miss\";\n\nclass Game {\n  private oszParser: OSZParser;\n  private pczParser: PCZParser;\n  private audioManager: AudioManager;\n  private renderer: GameRenderer | null;\n  private beatmaps: Array<{ filename: string; data: Beatmap }>;\n  private currentBeatmap: Beatmap | null;\n  private isend: boolean;\n  private keyMap: string[];\n  private pressed: Set<number>;\n  private columns: HitObject[][];\n  private nextIndex: number[];\n  private holdingLN: (HitObject | null)[];\n  private windows: {\n    perfect: number;\n    great: number;\n    good: number;\n    bad: number;\n    miss: number;\n    max_window: number;\n  };\n  private stats: {\n    score: number;\n    combo: number;\n    acc: number;\n    totalHits: number;\n    weightedHits: number;\n    judgements: Record<string, number>;\n  };\n  private animationId: number | null;\n  private hitsound: HTMLAudioElement;\n  private dosound: HTMLAudioElement;\n  private isAuto: boolean;\n  private isntPaused: boolean;\n  private ShowScore: any;\n  private waitingForStart: boolean;\n  private progressFill: HTMLElement | null | undefined;\n  private currentTimeElement: HTMLElement | null | undefined;\n  private totalTimeElement: HTMLElement | null | undefined;\n  private resultPanel: HTMLElement | null | undefined;\n  private infoPanelElement: HTMLElement | null | undefined;\n  private naturalEnd: boolean;\n  private offset: number; // \n  private measureOffset: number; // \n  private audioLeadIn: number; // \n\n  constructor() {\n    this.oszParser = new OSZParser();\n    this.pczParser = new PCZParser();\n    this.audioManager = new AudioManager();\n    this.renderer = null;\n    this.offset = 0; // 0\n    this.measureOffset = 0; // 0\n    this.audioLeadIn = 0; // 0\n    if (document.getElementById(\"progressFill\")) {\n      this.progressFill = document.getElementById(\"progressFill\");\n    }\n    this.currentTimeElement = document.getElementById(\"currentTime\");\n    this.totalTimeElement = document.getElementById(\"totalTime\");\n    this.resultPanel = document.getElementById(\"resultPanel\");\n    this.infoPanelElement = document.querySelector(\n      \".info-panel\",\n    ) as HTMLElement | null;\n    this.naturalEnd = false;\n\n    this.audioManager.onEnded = () => {\n      this.ShowScore = this.stats;\n      this.isend = true;\n      this.naturalEnd = true;\n      this.stop();\n      if (this.renderer) this.renderer.clearHitEffects();\n      // \n      this.columns = [[], [], [], []];\n      if (this.resultPanel) {\n        // \n        this.resultPanel.style.position = \"absolute\";\n        this.resultPanel.style.top = \"0\";\n        this.resultPanel.style.left = \"0\";\n        this.resultPanel.style.width = \"0\";\n        this.resultPanel.style.height = \"100%\";\n        this.resultPanel.style.backgroundColor = \"#ADD8E6\"; // \n        this.resultPanel.style.transition = \"width 0.8s ease-in-out\";\n        this.resultPanel.style.zIndex = \"9999\";\n        this.resultPanel.style.overflow = \"hidden\";\n\n        // Charttransition\n        if (this.infoPanelElement) {\n          this.infoPanelElement.style.transition = \"all 0.8s ease-in-out\";\n        }\n\n        // \n        setTimeout(() => {\n          this.resultPanel!.style.width = \"40%\";\n          // Chart\n          if (this.infoPanelElement) {\n            this.infoPanelElement.style.transform = \"translateX(40vw)\";\n          }\n        }, 100);\n      }\n\n      // \n      this.ToResult(this.stats);\n    };\n    this.beatmaps = [];\n    this.currentBeatmap = null;\n    this.isend = true;\n    // \n    this.keyMap = [\"d\", \"f\", \"j\", \"k\"]; // \n    this.pressed = new Set();\n    this.columns = [[], [], [], []]; // \n    this.nextIndex = [0, 0, 0, 0]; // \n    this.holdingLN = [null, null, null, null]; // LN\n\n    // ms\n    this.windows = {\n      perfect: 22,\n      great: 46,\n      good: 86,\n      bad: 136,\n      miss: 180,\n      max_window: 179,\n    };\n\n    // \n    this.stats = {\n      score: 0,\n      combo: 0,\n      acc: 100,\n      totalHits: 0,\n      weightedHits: 0,\n      judgements: { Perfect: 0, Great: 0, Good: 0, Bad: 0, Miss: 0 },\n    };\n\n    this.animationId = null;\n    this.init().then(null);\n    this.hitsound = new Audio(\"res/Enda.wav\");\n    this.hitsound.volume = 1;\n    this.dosound = new Audio(\"res/Okar.wav\");\n    this.dosound.volume = 0.7;\n    this.isAuto = false;\n    this.getAutos();\n    this.isntPaused = false;\n    this.waitingForStart = false;\n  }\n  getAutos() {\n    if (this.isAuto) {\n      this.windows = {\n        perfect: 30,\n        great: 200,\n        good: 300,\n        bad: 400,\n        miss: 500,\n        max_window: 1,\n      };\n    } else {\n      this.windows = {\n        perfect: 22,\n        great: 46,\n        good: 86,\n        bad: 136,\n        miss: 180,\n        max_window: 179,\n      };\n    }\n  }\n\n  // \n  saveSettings(): void {\n    const settings = {\n      showSV: (document.getElementById(\"showSV\") as HTMLInputElement).checked,\n      showKeyGroup: (\n        document.getElementById(\"showKeyGroup\") as HTMLInputElement\n      ).checked,\n      scrollSpeed: parseFloat(\n        (document.getElementById(\"scrollSpeed\") as HTMLInputElement).value,\n      ),\n      autoPlay: (document.getElementById(\"autoPlayBtn\") as HTMLInputElement)\n        .checked,\n      speedSlider: parseFloat(\n        (document.getElementById(\"speedSlider\") as HTMLInputElement).value,\n      ),\n      language: (document.getElementById(\"languageSelect\") as HTMLSelectElement)\n        .value,\n      disableVsync: (\n        document.getElementById(\"disableVsync\") as HTMLInputElement\n      ).checked,\n      offset: this.offset, // offset\n      measureOffset: this.measureOffset, // offset\n      audioLeadIn: this.audioLeadIn, // \n    };\n\n    localStorage.setItem(\"gameSettings\", JSON.stringify(settings));\n\n    // \n    this.showToast(\"\");\n  }\n\n  // \n  loadSettings(): void {\n    try {\n      const saved = localStorage.getItem(\"gameSettings\");\n      if (!saved) {\n        return;\n      }\n\n      const settings = JSON.parse(saved);\n\n      // \n      (document.getElementById(\"showSV\") as HTMLInputElement).checked =\n        settings.showSV;\n      (document.getElementById(\"showKeyGroup\") as HTMLInputElement).checked =\n        settings.showKeyGroup;\n      (document.getElementById(\"autoPlayBtn\") as HTMLInputElement).checked =\n        settings.autoPlay;\n      (document.getElementById(\"disableVsync\") as HTMLInputElement).checked =\n        settings.disableVsync || false;\n\n      // \n      (document.getElementById(\"scrollSpeed\") as HTMLInputElement).value =\n        settings.scrollSpeed.toString();\n      (document.getElementById(\"speedSlider\") as HTMLInputElement).value =\n        settings.speedSlider.toString();\n\n      // \n      (document.getElementById(\"languageSelect\") as HTMLSelectElement).value =\n        settings.language;\n\n      // offset\n      if (settings.offset !== undefined) {\n        this.offset = settings.offset;\n        const offsetSlider = document.getElementById(\n          \"offsetSlider\",\n        ) as HTMLInputElement;\n        if (offsetSlider) {\n          offsetSlider.value = this.offset.toString();\n          this.updateOffsetDisplay();\n        }\n      }\n\n      // audioLeadIn\n      if (settings.audioLeadIn !== undefined) {\n        this.audioLeadIn = settings.audioLeadIn;\n        // audioLeadIn0\n        if (this.audioLeadIn > 0) {\n          this.showAudioLeadInInfo(this.audioLeadIn);\n        } else {\n          this.hideAudioLeadInInfo();\n        }\n      }\n\n      // offset\n      if (settings.measureOffset !== undefined) {\n        this.measureOffset = settings.measureOffset;\n        const measureOffsetSlider = document.getElementById(\n          \"measureOffsetSlider\",\n        ) as HTMLInputElement;\n        if (measureOffsetSlider) {\n          measureOffsetSlider.value = this.measureOffset.toString();\n          document.getElementById(\"measureOffsetValue\")!.textContent =\n            `${this.measureOffset}ms`;\n        }\n        if (this.renderer) {\n          this.renderer.setMeasureOffset(this.measureOffset);\n        }\n      }\n\n      // \n      document.getElementById(\"scrollSpeedValue\")!.textContent =\n        settings.scrollSpeed.toString();\n      document.getElementById(\"speedValue\")!.textContent =\n        settings.speedSlider.toFixed(1) + \"x\";\n\n      // renderer\n      if (this.renderer) {\n        this.renderer.setShowSV(settings.showSV);\n        this.renderer.setShowKeyGroup(settings.showKeyGroup);\n        this.renderer.setScrollSpeed(settings.scrollSpeed);\n        this.renderer.setDisableVsync(settings.disableVsync || false);\n      }\n      this.audioManager.setPlaybackRate(settings.speedSlider);\n      this.isAuto = settings.autoPlay;\n      this.getAutos();\n\n      // i18next\n      const langSelect = document.getElementById(\n        \"languageSelect\",\n      ) as HTMLSelectElement;\n      if (langSelect.value !== settings.language) {\n        langSelect.value = settings.language;\n        langSelect.dispatchEvent(new Event(\"change\"));\n      }\n\n      this.showToast(\"\");\n    } catch (error) {\n      console.error(\":\", error);\n      this.showToast(\"\");\n    }\n  }\n\n  // \n  clearSettings(): void {\n    if (!confirm(\"\")) {\n      return;\n    }\n\n    // \n    (document.getElementById(\"showSV\") as HTMLInputElement).checked = true;\n    (document.getElementById(\"showKeyGroup\") as HTMLInputElement).checked =\n      true;\n    (document.getElementById(\"scrollSpeed\") as HTMLInputElement).value = \"40\";\n    (document.getElementById(\"autoPlayBtn\") as HTMLInputElement).checked =\n      false;\n    (document.getElementById(\"speedSlider\") as HTMLInputElement).value = \"1\";\n    (document.getElementById(\"languageSelect\") as HTMLSelectElement).value =\n      \"en\";\n\n    // \n    document.getElementById(\"scrollSpeedValue\")!.textContent = \"40\";\n    document.getElementById(\"speedValue\")!.textContent = \"1.0x\";\n\n    // renderer\n    if (this.renderer) {\n      this.renderer.setShowSV(true);\n      this.renderer.setShowKeyGroup(true);\n      this.renderer.setScrollSpeed(40);\n    }\n    this.audioManager.setPlaybackRate(1.0);\n    this.isAuto = false;\n    this.getAutos();\n\n    // \n    const langSelect = document.getElementById(\n      \"languageSelect\",\n    ) as HTMLSelectElement;\n    langSelect.dispatchEvent(new Event(\"change\"));\n\n    // \n    localStorage.removeItem(\"gameSettings\");\n\n    this.showToast(\"\");\n  }\n\n  // \n  private showToast(message: string): void {\n    // toast\n    let toast = document.getElementById(\"settingsToast\");\n    if (!toast) {\n      toast = document.createElement(\"div\");\n      toast.id = \"settingsToast\";\n      toast.style.cssText = `\n                position: fixed;\n                top: 20px;\n                right: 20px;\n                background: rgba(0, 0, 0, 0.8);\n                color: white;\n                padding: 12px 20px;\n                border-radius: 6px;\n                z-index: 1000;\n                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n                font-size: 14px;\n                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n                transition: opacity 0.3s ease;\n                opacity: 0;\n            `;\n      document.body.appendChild(toast);\n    }\n\n    toast.style.display = \"block\";\n    toast.textContent = message;\n    toast.style.opacity = \"1\";\n\n    // 2\n    setTimeout(() => {\n      toast!.style.opacity = \"0\";\n      setTimeout(() => {\n        if (toast) {\n          toast.style.display = \"none\";\n        }\n      }, 300);\n    }, 2000);\n  }\n  async init() {\n    const canvas = document.getElementById(\"gameCanvas\") as HTMLCanvasElement;\n    this.renderer = new GameRenderer(canvas);\n\n    // \n    await this.audioManager.loadSound(\"hit\", \"res/Enda.wav\");\n    await this.audioManager.loadSound(\"judge\", \"res/Okar.wav\");\n\n    this.bindEvents();\n    this.getAutos();\n    this.loadSettings(); // \n  }\n\n  bindEvents() {\n    document\n      .getElementById(\"oszFile\")!\n      .addEventListener(\"change\", (e) =>\n        this.loadFile((e.target as HTMLInputElement).files![0]),\n      );\n    document\n      .getElementById(\"difficultySelect\")!\n      .addEventListener(\"change\", (e) => {\n        const index = parseInt((e.target as HTMLSelectElement).value);\n        if (!isNaN(index)) this.selectDifficulty(index);\n      });\n\n    document\n      .getElementById(\"playBtn\")!\n      .addEventListener(\"click\", () => this.play(true));\n    document\n      .getElementById(\"pauseBtn\")!\n      .addEventListener(\"click\", () => this.pause());\n    document\n      .getElementById(\"stopBtn\")!\n      .addEventListener(\"click\", () => this.stop());\n\n    document.getElementById(\"speedSlider\")!.addEventListener(\"input\", (e) => {\n      const speed = parseFloat((e.target as HTMLInputElement).value);\n      document.getElementById(\"speedValue\")!.textContent =\n        speed.toFixed(1) + \"x\";\n      this.audioManager.setPlaybackRate(speed);\n      this.saveSettings(); // \n    });\n\n    // Offset slider\n    document.getElementById(\"offsetSlider\")!.addEventListener(\"input\", (e) => {\n      const offset = parseInt((e.target as HTMLInputElement).value);\n      this.offset = offset;\n      this.updateOffsetDisplay();\n      this.saveSettings(); // \n    });\n\n    // Offset\n    document.getElementById(\"offsetMinus10\")!.addEventListener(\"click\", () => {\n      this.adjustOffset(-10);\n    });\n\n    document.getElementById(\"offsetReset\")!.addEventListener(\"click\", () => {\n      this.resetOffset();\n    });\n\n    document.getElementById(\"offsetPlus10\")!.addEventListener(\"click\", () => {\n      this.adjustOffset(10);\n    });\n\n    // Offset slider\n    document\n      .getElementById(\"measureOffsetSlider\")!\n      .addEventListener(\"input\", (e) => {\n        const offset = parseInt((e.target as HTMLInputElement).value);\n        this.measureOffset = offset;\n        document.getElementById(\"measureOffsetValue\")!.textContent =\n          `${offset}ms`;\n        if (this.renderer) {\n          this.renderer.setMeasureOffset(offset);\n        }\n        this.saveSettings(); // \n      });\n\n    // Offset\n    document\n      .getElementById(\"measureOffsetMinus10\")!\n      .addEventListener(\"click\", () => {\n        this.adjustMeasureOffset(-10);\n      });\n\n    document\n      .getElementById(\"measureOffsetReset\")!\n      .addEventListener(\"click\", () => {\n        this.resetMeasureOffset();\n      });\n\n    document\n      .getElementById(\"measureOffsetPlus10\")!\n      .addEventListener(\"click\", () => {\n        this.adjustMeasureOffset(10);\n      });\n    document.getElementById(\"showSV\")!.addEventListener(\"change\", (e) => {\n      this.renderer!.setShowSV((e.target as HTMLInputElement).checked);\n      this.saveSettings(); // \n    });\n    document.getElementById(\"showKeyGroup\")!.addEventListener(\"change\", (e) => {\n      this.renderer!.setShowKeyGroup((e.target as HTMLInputElement).checked);\n      this.saveSettings(); // \n    });\n    document.getElementById(\"scrollSpeed\")!.addEventListener(\"input\", (e) => {\n      const speed = parseFloat((e.target as HTMLInputElement).value);\n      //\n      document.getElementById(\"scrollSpeedValue\")!.textContent =\n        speed.toString();\n      this.renderer!.setScrollSpeed(speed);\n      this.saveSettings(); // \n    });\n\n    // \n    window.addEventListener(\"keydown\", (e) => this.onKeyDown(e));\n    window.addEventListener(\"keyup\", (e) => this.onKeyUp(e));\n    document.getElementById(\"autoPlayBtn\")!.addEventListener(\"change\", (e) => {\n      this.isAuto = (e.target as HTMLInputElement).checked; // \n      this.getAutos();\n      this.saveSettings(); // \n    });\n\n    // \n    document.getElementById(\"disableVsync\")!.addEventListener(\"change\", (e) => {\n      if (this.renderer) {\n        this.renderer.setDisableVsync((e.target as HTMLInputElement).checked);\n      }\n      this.saveSettings(); // \n    });\n\n    // \n    document\n      .getElementById(\"languageSelect\")!\n      .addEventListener(\"change\", () => {\n        this.saveSettings(); // \n      });\n\n    // \n    document\n      .getElementById(\"saveSettingsBtn\")!\n      .addEventListener(\"click\", () => this.saveSettings());\n    document\n      .getElementById(\"clearSettingsBtn\")!\n      .addEventListener(\"click\", () => this.clearSettings());\n\n    let escPressTimer: ReturnType<typeof setTimeout> | null = null;\n    window.addEventListener(\"keydown\", (e) => {\n      if (e.key === \"Escape\") {\n        // \n        if (escPressTimer) return;\n        // \n        escPressTimer = setTimeout(() => {\n          this.togglePause(); // /\n          escPressTimer = null; // \n        }, 1000); //  1000 ms\n      }\n    });\n    window.addEventListener(\"keyup\", (e) => {\n      if (e.key === \"Escape\") {\n        // \n        if (escPressTimer) {\n          clearTimeout(escPressTimer);\n          escPressTimer = null;\n        }\n      }\n    });\n  }\n  togglePause() {\n    if (!this.currentBeatmap) return;\n\n    if (this.isntPaused) {\n      this.pause();\n    } else {\n      //  ESC \n      this.pressed.clear();\n      this.renderer!.setPressedLanes(this.pressed);\n\n      this.play(this.isend);\n    }\n\n    this.saveSettings(); // \n  }\n\n  keyToColumn(key: string) {\n    const k = key.toLowerCase();\n    return this.keyMap.indexOf(k);\n  }\n\n  onKeyDown(e: KeyboardEvent) {\n    const col = this.keyToColumn(e.key);\n    if (col === -1) return;\n\n    if (!this.pressed.has(col)) {\n      this.pressed.add(col);\n      this.renderer!.setPressedLanes(this.pressed);\n      this.tryJudgeOnPress(col).then(() => {});\n      this.play_hit().then(null);\n    }\n    e.preventDefault();\n  }\n\n  onKeyUp(e: KeyboardEvent) {\n    const col = this.keyToColumn(e.key);\n    if (col === -1) return;\n\n    if (this.pressed.has(col)) {\n      this.pressed.delete(col);\n      this.renderer!.setPressedLanes(this.pressed);\n      this.tryJudgeOnRelease(col);\n    }\n    e.preventDefault();\n  }\n\n  async tryJudgeOnPress(col: number) {\n    const t = this.getAdjustedTime(); // \n    let list = this.columns[col];\n    let idx = this.nextIndex[col];\n\n    // miss\n    while (idx < list.length && list[idx].time < t - this.windows.max_window) {\n      // noteLN -> Miss\n      const obj = list[idx];\n      if (!obj.judgedHead) {\n        await this.applyJudgement(\"Miss\" as JudgementType, obj, col, true);\n        obj.judgedHead = true;\n      }\n      idx++;\n    }\n    this.nextIndex[col] = idx;\n\n    // \n    if (idx >= list.length) {\n      return;\n    }\n\n    const obj = list[idx];\n    if (!obj.isLongNote) {\n      const diff = Math.abs(obj.time - t);\n      const result = this.getJudgement(diff);\n      if (result) {\n        try {\n          await this.applyJudgement(result, obj, col, true);\n          obj.judgedHead = true;\n          this.nextIndex[col]++;\n        } catch (error) {\n          console.error(\"Error applying judgement:\", error);\n          // \n        }\n      } else {\n        return \"cat_err\";\n      }\n    } else {\n      // LN\n      if (!obj.judgedHead) {\n        const diff = Math.abs(obj.time - t);\n        const result = this.getJudgement(diff);\n        if (result) {\n          try {\n            await this.applyJudgement(result as JudgementType, obj, col, true);\n            obj.judgedHead = true;\n            this.holdingLN[col] = obj; // \n            // LN\n          } catch (error) {\n            console.error(\"Error applying judgement:\", error);\n            // \n          }\n        }\n      }\n    }\n  }\n\n  tryJudgeOnRelease(col: number) {\n    const t = this.getAdjustedTime(); // \n    const obj = this.holdingLN[col];\n    if (!obj) return;\n\n    // LN\n    const diff = Math.abs(obj.endTime - t);\n    const result = this.getJudgement(diff);\n    if (result) {\n      this.applyJudgement(result, obj, col, false).then(null);\n    } else {\n      // Miss\n      this.applyJudgement(\"Miss\" as JudgementType, obj, col, false).then(null);\n    }\n\n    // LN\n    // nextIndexLN\n    const list = this.columns[col];\n    while (\n      this.nextIndex[col] < list.length &&\n      list[this.nextIndex[col]] === obj\n    ) {\n      this.nextIndex[col]++;\n    }\n    this.holdingLN[col] = null;\n  }\n\n  getJudgement(diffMs: number): JudgementType | null {\n    if (diffMs <= this.windows.perfect) return \"Perfect\";\n    if (diffMs <= this.windows.great) return \"Great\";\n    if (diffMs <= this.windows.good) return \"Good\";\n    if (diffMs <= this.windows.bad) return \"Bad\";\n    if (diffMs <= this.windows.miss) return \"Miss\";\n    return null;\n  }\n\n  async applyJudgement(\n    j: JudgementType,\n    obj: HitObject,\n    col: number,\n    isHead: boolean,\n  ): Promise<void> {\n    // \n    const weightMap = {\n      Perfect: 1.0,\n      Great: 0.9,\n      Good: 0.7,\n      Bad: 0.4,\n      Miss: 0.0,\n    };\n    const scoreAddMap = {\n      Perfect: 300,\n      Great: 200,\n      Good: 100,\n      Bad: 50,\n      Miss: 0,\n    };\n    const weight = weightMap[j];\n    const scoreAdd = scoreAddMap[j];\n\n    if (j === \"Miss\") {\n      this.stats.combo = 0;\n    } else {\n      this.stats.combo += 1;\n      this.stats.score += scoreAdd + Math.floor(this.stats.combo * 0.5);\n    }\n\n    this.stats.totalHits += 1;\n    this.stats.weightedHits += weight;\n    this.stats.acc = (this.stats.weightedHits / this.stats.totalHits) * 100;\n    this.stats.judgements[j] = (this.stats.judgements[j] || 0) + 1;\n\n    // \n    if (obj.isLongNote) {\n      if (isHead) obj.judgedHead = true;\n      else obj.judgedTail = true;\n    } else {\n      obj.judgedHead = true;\n    }\n\n    // \n    let color = \"#FFFFFF\"; // \n    if ((this.renderer as any).showKeyGroup) {\n      // j  'Great' ,'Perfect' \n      if (j !== \"Miss\") {\n        if (j === \"Bad\") {\n          color = \"#afaeae\";\n        } else if (j === \"Great\") {\n          color = \"#7ecca7\";\n        } else {\n          const colors = (this.renderer as any).keyGroupColors;\n          if (colors && Array.isArray(colors) && colors.length > 0) {\n            const index = Math.abs(obj.keyGroup || 0) % colors.length;\n            color = colors[index] || \"#FFFFFF\";\n          } else {\n            color = \"#FFFFFF\";\n          }\n          if (j === \"Perfect\") {\n            await this.renderer!.createHitEffect(col, \"#eade57\");\n          }\n        }\n      }\n    }\n    // \n    if (j !== \"Miss\") {\n      //  Promise.all \n      await Promise.all([\n        this.renderer!.createHitEffect(col, color),\n        this.play_hit(),\n        j === \"Perfect\" || j === \"Great\" ? this.Okar_hit() : Promise.resolve(),\n      ]);\n    }\n    await this.renderer!.createHitEffect(col, color);\n    this.renderer!.setStats(this.stats);\n  }\n  async play_hit() {\n    this.audioManager.playSound_nonBlocking(\"hit\", 1.0);\n  }\n  async Okar_hit() {\n    this.audioManager.playSound_nonBlocking(\"judge\", 0.7);\n  }\n  async loadFile(file: File) {\n    if (this.currentBeatmap) {\n      await this.audioManager.stop();\n      await this.stop();\n    }\n    if (!file) return;\n    try {\n      let ext: Object;\n      ext = file.name.split(\".\").pop()!.toLowerCase();\n      let files;\n      if (ext === \"osz\") files = await this.oszParser.loadOSZ(file);\n      else if (ext === \"osu\") files = await this.oszParser.loadSingleOSU(file);\n      else if (ext === \"pcz\") files = await this.pczParser.loadPCZ(file);\n      else if (PCZParser.isJSONBeatmapFile(file))\n        files = await this.pczParser.loadSingleJSON(file);\n      else {\n        alert(\"\");\n        return;\n      }\n\n      this.beatmaps = [];\n      if (files.beatmaps) {\n        for (const bmData of files.beatmaps) {\n          const beatmap = BeatmapParserFactory.parse(bmData.content);\n          this.beatmaps.push({ filename: bmData.filename, data: beatmap });\n        }\n      }\n\n      const select = document.getElementById(\n        \"difficultySelect\",\n      ) as HTMLSelectElement;\n      select.innerHTML = '<option value=\"\"></option>';\n      this.beatmaps.forEach(\n        (bm: { filename: string; data: Beatmap }, index: number) => {\n          const option = document.createElement(\"option\");\n          option.value = index.toString();\n          option.textContent =\n            bm.data.metadata.Version || `Difficulty ${index + 1}`;\n          select.appendChild(option);\n        },\n      );\n      select.disabled = false;\n\n      if (files.audio) {\n        await this.audioManager.loadAudio(files.audio!.blob);\n        if (this.totalTimeElement)\n          this.totalTimeElement.textContent = this.formatTime(\n            this.audioManager.getDuration(),\n          );\n      }\n\n      if (this.beatmaps.length > 0) {\n        (select as HTMLSelectElement).value = \"0\";\n        this.selectDifficulty(0);\n      }\n\n      // \n      if (files.background) {\n        try {\n          await this.renderer!.setBackgroundImageBlob(files.background!.blob);\n        } catch (e) {\n          console.warn(\"\", e);\n        }\n      }\n      const target = document.getElementById(\"gameCanvas\") as HTMLCanvasElement; // div\n      if (target) {\n        target.scrollIntoView({ behavior: \"smooth\" }); // \n      }\n    } catch (e: any) {\n      console.error(\"\", e);\n      alert(\": \" + e.message);\n    }\n  }\n\n  selectDifficulty(index: number) {\n    this.currentBeatmap = this.beatmaps[index]!.data;\n    this.renderer!.setBeatmap(this.currentBeatmap);\n\n    // \n    const audioLeadInStr = this.currentBeatmap.general.AudioLeadIn;\n    if (audioLeadInStr) {\n      const audioLeadIn = parseInt(audioLeadInStr, 10);\n      if (!isNaN(audioLeadIn)) {\n        this.setAudioLeadIn(audioLeadIn);\n        console.log(` AudioLeadIn: ${audioLeadIn}ms`);\n        this.showAudioLeadInInfo(audioLeadIn);\n      }\n    } else {\n      this.setAudioLeadIn(0); // 0\n      this.hideAudioLeadInInfo();\n    }\n\n    // \n    this.columns = [[], [], [], []];\n    for (const obj of this.currentBeatmap.hitObjects) {\n      this.columns[obj.column].push(obj);\n      obj.judgedHead = false;\n      obj.judgedTail = false;\n    }\n    for (let c = 0; c < 4; c++) {\n      this.columns[c].sort((a, b) => a.time - b.time);\n      this.nextIndex[c] = 0;\n      this.holdingLN[c] = null;\n    }\n\n    // \n    this.renderer!.setBeatmap(this.currentBeatmap);\n\n    // UI\n    const { Creator, Artist, Title, Version } = this.currentBeatmap.metadata;\n    document.getElementById(\"songTitle\")!.textContent = Title || \"\";\n    document.getElementById(\"songArtist\")!.textContent =\n      \"Artist: \" + (Artist || \"\");\n    document.getElementById(\"songMapper\")!.textContent =\n      \"Chart: \" + (Creator || \"\") + \" | Difficult: \" + (Version || \"\");\n\n    // \n    this.stats = {\n      score: 0,\n      combo: 0,\n      acc: 100,\n      totalHits: 0,\n      weightedHits: 0,\n      judgements: { Perfect: 0, Great: 0, Good: 0, Bad: 0, Miss: 0 },\n    };\n    this.renderer!.setStats(this.stats);\n\n    // \n    if (this.progressFill) {\n      this.progressFill.style.width = \"0%\";\n      this.progressFill.style.height = \"\";\n      this.progressFill.style.position = \"\";\n      this.progressFill.style.top = \"\";\n      this.progressFill.style.left = \"\";\n      this.progressFill.style.zIndex = \"\";\n      this.progressFill.style.transition = \"\";\n      this.progressFill.style.background = \"\";\n      this.progressFill.style.boxShadow = \"\";\n    }\n\n    // \n    if (this.resultPanel) {\n      this.resultPanel.style.width = \"0\";\n      this.resultPanel.style.transition = \"none\";\n      this.resultPanel.style.position = \"\";\n      this.resultPanel.style.top = \"\";\n      this.resultPanel.style.left = \"\";\n      this.resultPanel.style.height = \"\";\n      this.resultPanel.style.backgroundColor = \"\";\n      this.resultPanel.style.zIndex = \"\";\n      this.resultPanel.style.overflow = \"\";\n    }\n\n    // Chart\n    if (this.infoPanelElement) {\n      this.infoPanelElement.style.transition = \"none\";\n      this.infoPanelElement.style.transform = \"\";\n    }\n\n    (document.getElementById(\"playBtn\") as HTMLButtonElement).disabled = false;\n    (document.getElementById(\"pauseBtn\") as HTMLButtonElement).disabled = false;\n    (document.getElementById(\"stopBtn\") as HTMLButtonElement).disabled = false;\n\n    this.renderer!.render(0);\n  }\n\n  play(ev: boolean) {\n    // \n    if (!this.currentBeatmap) return;\n\n    // isntPausedfalsecolumns\n    if (!this.isntPaused && this.columns.some((col) => col.length > 0)) {\n      this.resume();\n      return;\n    }\n\n    // \n    this.stop(); // \n    // \n    if (this.waitingForStart) return;\n\n    // \n    this.waitingForStart = true;\n    const overlay = document.getElementById(\"pauseOverlay\")!;\n    overlay.style.opacity = \"0.8\";\n    overlay.innerHTML =\n      '<div style=\"color:white;font-size:32px;text-align:center;margin-top:40vh;\">Press Any Button...</div>';\n    // \n    const startHandler = (e: KeyboardEvent) => {\n      //   Esc\n      if (e.key === \"Escape\") return;\n\n      //  \n      window.removeEventListener(\"keydown\", startHandler);\n      overlay.style.opacity = \"0\";\n      overlay.innerHTML = \"\";\n      this.waitingForStart = false;\n\n      if (ev && this.isntPaused) {\n        this.stats = {\n          score: 0,\n          combo: 0,\n          acc: 100,\n          totalHits: 0,\n          weightedHits: 0,\n          judgements: { Perfect: 0, Great: 0, Good: 0, Bad: 0, Miss: 0 },\n        };\n      }\n\n      this.saveSettings(); // \n\n      this.startGame();\n      this.isend = false;\n    };\n    window.addEventListener(\"keydown\", startHandler);\n  }\n  startGame() {\n    const settingsPanel = document.querySelector(\".settings-panel\");\n    const playbackPanel = document.querySelector(\".playback-controls\");\n    settingsPanel!.classList.toggle(\".settings-panel\", false);\n    playbackPanel!.classList.toggle(\".playback-controls\", false);\n    // \n    this.pressed.clear();\n    this.renderer!.setPressedLanes(this.pressed);\n\n    // columns\n    // columns\n    if (this.currentBeatmap && this.columns.every((col) => col.length === 0)) {\n      this.columns = [[], [], [], []];\n      for (const obj of this.currentBeatmap.hitObjects) {\n        this.columns[obj.column].push(obj);\n        obj.judgedHead = false;\n        obj.judgedTail = false;\n      }\n      for (let c = 0; c < 4; c++) {\n        this.columns[c].sort((a, b) => a.time - b.time);\n      }\n      this.nextIndex = [0, 0, 0, 0];\n      this.holdingLN = [null, null, null, null];\n    }\n\n    const t = this.getRawAudioTime() / 1000; // \n    this.audioManager.play(t);\n    this.startGameLoop();\n    const overlay = document.getElementById(\"pauseOverlay\");\n    overlay!.style.opacity = \"0\";\n    this.isntPaused = true;\n    // this.renderer.ctx.opacity = 1;\n  }\n\n  pause() {\n    this.audioManager.pause();\n    this.stopGameLoop();\n    // \n    const overlay: HTMLElement | null = document.getElementById(\"pauseOverlay\");\n    overlay!.style.opacity = \"0.6\"; // \n    overlay!.innerHTML =\n      '<div style=\"color:white;font-size:50px;text-align:center;margin-top:40vh;\">Pausing...</div>';\n    const settingsPanel: HTMLElement | null =\n      document.querySelector(\".settings-panel\");\n    const playbackPanel: HTMLElement | null =\n      document.querySelector(\".playback-controls\");\n    settingsPanel!.classList.toggle(\"active\", true);\n    playbackPanel!.classList.toggle(\"active\", true);\n    this.isntPaused = false;\n\n    this.saveSettings(); // \n  }\n\n  resume() {\n    const t = this.getRawAudioTime() / 1000; // \n    this.audioManager.play(t);\n    this.startGameLoop();\n    const overlay = document.getElementById(\"pauseOverlay\");\n    overlay!.style.opacity = \"0\";\n    this.isntPaused = true;\n  }\n\n  stop() {\n    this.audioManager.stop();\n    this.stopGameLoop();\n\n    // 0 \n    this.renderer!.render(0).then(() => {});\n\n    // \n    this.pressed.clear();\n    this.renderer!.setPressedLanes(this.pressed);\n\n    this.holdingLN = [null, null, null, null];\n    this.columns = [[], [], [], []]; //  columns\n    this.nextIndex = [0, 0, 0, 0];\n    this.waitingForStart = false;\n    const wasNaturalEnd = this.naturalEnd;\n    this.naturalEnd = false;\n    //  hit \n    if (this.currentBeatmap?.hitObjects) {\n      for (const obj of this.currentBeatmap.hitObjects) {\n        obj.judgedHead = false;\n        obj.judgedTail = false;\n      }\n    }\n    // \n    if (!wasNaturalEnd) {\n      this.stats = {\n        score: 0,\n        combo: 0,\n        acc: 100,\n        totalHits: 0,\n        weightedHits: 0,\n        judgements: { Perfect: 0, Great: 0, Good: 0, Bad: 0, Miss: 0 },\n      };\n      this.renderer!.setStats(this.stats);\n    }\n    // this.renderer.ctx.opacity = 0;\n\n    // \n    const overlay = document.getElementById(\"pauseOverlay\");\n    overlay!.style.opacity = \"0.6\";\n    this.isntPaused = false;\n    if (!this.audioManager.getIsPlaying() && !this.isend) {\n      this.isend = true;\n    }\n\n    //  hitEffects\n    if (this.renderer) this.renderer.clearHitEffects();\n    if (this.isend && this.isntPaused) {\n      this.ToResult(this.ShowScore);\n    }\n\n    // \n    if (this.progressFill) {\n      this.progressFill.style.width = \"0%\";\n      this.progressFill.style.height = \"\";\n      this.progressFill.style.position = \"\";\n      this.progressFill.style.top = \"\";\n      this.progressFill.style.left = \"\";\n      this.progressFill.style.zIndex = \"\";\n      this.progressFill.style.transition = \"\";\n      this.progressFill.style.background = \"\";\n      this.progressFill.style.boxShadow = \"\";\n    }\n\n    // \n    if (this.resultPanel && !wasNaturalEnd) {\n      this.resultPanel.style.width = \"0\";\n      this.resultPanel.style.transition = \"none\";\n      this.resultPanel.style.position = \"\";\n      this.resultPanel.style.top = \"\";\n      this.resultPanel.style.left = \"\";\n      this.resultPanel.style.height = \"\";\n      this.resultPanel.style.backgroundColor = \"\";\n      this.resultPanel.style.zIndex = \"\";\n      this.resultPanel.style.overflow = \"\";\n    }\n\n    // Chart\n    if (this.infoPanelElement && !wasNaturalEnd) {\n      this.infoPanelElement.style.transition = \"none\";\n      this.infoPanelElement.style.transform = \"\";\n    }\n\n    this.saveSettings(); // \n  }\n\n  ToResult(score: any) {\n    const resultLeftElement = document.getElementById(\"result-Left\");\n    if (resultLeftElement) {\n      resultLeftElement.textContent = score.score\n        ? score.score.toString()\n        : score;\n    }\n\n    // \n    if (this.resultPanel) {\n      const stats = score;\n      this.resultPanel.innerHTML = `\n                <div style=\"padding: 20px; color: #333; font-family: sans-serif;opacity: 1\">\n                    <h1 style=\"color: #444; margin-bottom: 20px;\"></h1>\n                    <h2 style=\"color: #444; margin-bottom: 20px;\">result</h2>\n                    <div style=\"margin-bottom: 10px;\">\n                        <strong>:</strong> ${stats.score}\n                    </div>\n                    <div style=\"margin-bottom: 10px;\">\n                        <strong>:</strong> ${stats.combo}\n                    </div>\n                    <div style=\"margin-bottom: 10px;\">\n                        <strong>:</strong> ${stats.acc.toFixed(2)}%\n                    </div>\n                    <div style=\"margin-top: 20px;\">\n                        <strong>:</strong>\n                        <div>Perfect: ${stats.judgements.Perfect}</div>\n                        <div>Great: ${stats.judgements.Great}</div>\n                        <div>Good: ${stats.judgements.Good}</div>\n                        <div>Bad: ${stats.judgements.Bad}</div>\n                        <div>Miss: ${stats.judgements.Miss}</div>\n                    </div>\n                </div>\n            `;\n    }\n  }\n\n  // offsetaudioLeadIn\n  getAdjustedTime(): number {\n    const rawTime = this.audioManager.getCurrentTime();\n    // offsetaudioLeadIn\n    return Math.max(0, rawTime + this.offset + this.audioLeadIn);\n  }\n\n  // offsetaudioLeadIn\n  getRawAudioTime(): number {\n    return this.audioManager.getCurrentTime();\n  }\n\n  // \n  getAudioLeadIn(): number {\n    return this.audioLeadIn;\n  }\n\n  // \n  setAudioLeadIn(leadIn: number): void {\n    this.audioLeadIn = leadIn;\n  }\n\n  // \n  showAudioLeadInInfo(leadIn: number): void {\n    const audioLeadInInfo = document.getElementById(\"audioLeadInInfo\");\n    const audioLeadInValue = document.getElementById(\"audioLeadInValue\");\n    if (audioLeadInInfo && audioLeadInValue) {\n      audioLeadInValue.textContent = `${leadIn}ms`;\n      audioLeadInInfo.style.display = \"block\";\n    }\n  }\n\n  // \n  hideAudioLeadInInfo(): void {\n    const audioLeadInInfo = document.getElementById(\"audioLeadInInfo\");\n    if (audioLeadInInfo) {\n      audioLeadInInfo.style.display = \"none\";\n    }\n  }\n\n  // offset\n  adjustOffset(delta: number): void {\n    const newOffset = this.offset + delta;\n    // -300300\n    this.offset = Math.max(-300, Math.min(300, newOffset));\n\n    const offsetSlider = document.getElementById(\n      \"offsetSlider\",\n    ) as HTMLInputElement;\n    offsetSlider.value = this.offset.toString();\n    this.updateOffsetDisplay();\n\n    this.saveSettings(); // \n  }\n\n  // offset\n  updateOffsetDisplay(): void {\n    const totalOffset = this.offset + this.audioLeadIn;\n    const displayText =\n      this.audioLeadIn > 0\n        ? `${this.offset}ms (: +${this.audioLeadIn}ms, : ${totalOffset}ms)`\n        : `${this.offset}ms`;\n    document.getElementById(\"offsetValue\")!.textContent = displayText;\n\n    // audioLeadIn\n    const audioLeadInValue = document.getElementById(\"audioLeadInValue\");\n    if (audioLeadInValue) {\n      audioLeadInValue.textContent = `${this.audioLeadIn}ms`;\n    }\n  }\n\n  // offset\n  resetOffset(): void {\n    this.offset = 0;\n    const offsetSlider = document.getElementById(\n      \"offsetSlider\",\n    ) as HTMLInputElement;\n    offsetSlider.value = \"0\";\n    this.updateOffsetDisplay();\n    this.saveSettings(); // \n  }\n\n  // offset\n  adjustMeasureOffset(delta: number): void {\n    const newOffset = this.measureOffset + delta;\n    // -100100\n    this.measureOffset = Math.max(-100, Math.min(100, newOffset));\n\n    const measureOffsetSlider = document.getElementById(\n      \"measureOffsetSlider\",\n    ) as HTMLInputElement;\n    measureOffsetSlider.value = this.measureOffset.toString();\n    document.getElementById(\"measureOffsetValue\")!.textContent =\n      `${this.measureOffset}ms`;\n    if (this.renderer) {\n      this.renderer.setMeasureOffset(this.measureOffset);\n    }\n    this.saveSettings(); // \n  }\n\n  // offset\n  resetMeasureOffset(): void {\n    this.measureOffset = 0;\n    const measureOffsetSlider = document.getElementById(\n      \"measureOffsetSlider\",\n    ) as HTMLInputElement;\n    measureOffsetSlider.value = \"0\";\n    document.getElementById(\"measureOffsetValue\")!.textContent = \"0ms\";\n\n    if (this.renderer) {\n      this.renderer.setMeasureOffset(0);\n    }\n    this.saveSettings(); // \n  }\n\n  startGameLoop() {\n    const loop = () => {\n      if (!this.audioManager.getIsPlaying()) return;\n      const currentTime = this.getAdjustedTime(); // \n      this.renderer!.render(currentTime);\n\n      const duration = this.audioManager.getDuration();\n      const rawCurrentTime = this.getRawAudioTime(); // \n      const progress =\n        duration > 0 ? (rawCurrentTime / 1000 / duration) * 100 : 0;\n      if (this.progressFill) this.progressFill.style.width = progress + \"%\";\n      if (this.currentTimeElement)\n        this.currentTimeElement.textContent = this.formatTime(\n          rawCurrentTime / 1000,\n        );\n\n      // Missmissnote/lnMiss\n      for (let c = 0; c < 4; c++) {\n        const list = this.columns[c];\n        while (this.nextIndex[c] < list.length) {\n          const obj = list[this.nextIndex[c]];\n          const deadline = obj.isLongNote ? obj.time : obj.time;\n          if (\n            deadline < currentTime - this.windows.max_window &&\n            !obj.judgedHead\n          ) {\n            this.applyJudgement(\n              (this.isAuto ? \"Perfect\" : \"Miss\") as JudgementType,\n              obj,\n              c,\n              true,\n            ).then(null);\n            obj.judgedHead = true;\n            // noteLNMiss\n            if (!obj.isLongNote) this.nextIndex[c]++;\n            else {\n              // LNMissMiss\n            }\n          } else {\n            break;\n          }\n        }\n\n        // LNMissmiss\n        const holdObj = this.holdingLN[c];\n        if (!holdObj) {\n          // LNmiss\n          const idx = this.nextIndex[c];\n          if (idx < list.length) {\n            const obj = list[idx];\n            if (obj.isLongNote && obj.judgedHead && !obj.judgedTail) {\n              if (obj.endTime < currentTime - this.windows.max_window) {\n                this.applyJudgement(\n                  (this.isAuto ? \"Perfect\" : \"Miss\") as JudgementType,\n                  obj,\n                  c,\n                  false,\n                ).then(null);\n                obj.judgedTail = true;\n                this.nextIndex[c]++;\n              }\n            }\n          }\n        }\n      }\n\n      this.animationId = requestAnimationFrame(loop);\n    };\n    this.animationId = requestAnimationFrame(loop);\n  }\n\n  stopGameLoop() {\n    if (this.animationId) cancelAnimationFrame(this.animationId);\n    this.animationId = null;\n  }\n\n  formatTime(seconds: any) {\n    const mins = Math.floor(seconds / 60);\n    const secs = Math.floor(seconds % 60);\n    return `${mins}:${secs.toString().padStart(2, \"0\")}`;\n  }\n}\n\nwindow.addEventListener(\"DOMContentLoaded\", () => {\n  new Game();\n});\n","document.addEventListener(\"DOMContentLoaded\", async () => {\n  // \n  const resources = {\n    en: {\n      translation: {\n        title: \"4Key Chart Player\",\n        \"controls.chooseFile\": \"Choose File\",\n        \"controls.difficulty\": \"Difficulty\",\n        \"controls.exit\": \"Exit?\",\n\n        \"info.notLoaded\": \"Chart Isn't Load In\",\n        \"info.artist\": \"Artist\",\n        \"info.mapper\": \"Mapper\",\n\n        \"settings.title\": \"Settings\",\n        \"settings.showSV\": \"Show SV\",\n        \"settings.showKeyGroup\": \"Show Key Group Color\",\n        \"settings.scrollSpeed\": \"Scroll Speed:\",\n        \"settings.autoPlay\": \"Auto Play\",\n        \"settings.language\": \"Language:\",\n        \"settings.save\": \"Save Settings\",\n        \"settings.clear\": \"Clear Settings\",\n        \"settings.disableVsync\": \"Disable V-Sync (Uncapped FPS)\",\n        \"settings.offset\": \"Audio Offset:\",\n        \"settings.measureOffset\": \"Measure Line Offset:\",\n        \"settings.audioLeadIn\": \"Audio Lead-In:\",\n\n        \"playback.play\": \"Play\",\n        \"playback.pause\": \"Pause\",\n        \"playback.stop\": \"Stop\",\n        \"playback.speed\": \"Speed\",\n      },\n    },\n    zh: {\n      translation: {\n        title: \"4Key\",\n        \"controls.chooseFile\": \"\",\n        \"controls.difficulty\": \"\",\n        \"controls.exit\": \"?\",\n\n        \"info.notLoaded\": \"\",\n        \"info.artist\": \"\",\n        \"info.mapper\": \"\",\n\n        \"settings.title\": \"\",\n        \"settings.showSV\": \" SV\",\n        \"settings.showKeyGroup\": \"\",\n        \"settings.scrollSpeed\": \"\",\n        \"settings.autoPlay\": \"\",\n        \"settings.language\": \"\",\n        \"settings.save\": \"\",\n        \"settings.clear\": \"\",\n        \"settings.disableVsync\": \"\",\n        \"settings.offset\": \"\",\n        \"settings.measureOffset\": \"\",\n        \"settings.audioLeadIn\": \"\",\n\n        \"playback.play\": \"\",\n        \"playback.pause\": \"\",\n        \"playback.stop\": \"\",\n        \"playback.speed\": \"\",\n      },\n    },\n  };\n\n  //  i18next\n\n  //  Electron \n  const isElectron =\n    !!window?.process?.versions?.electron ||\n    navigator.userAgent.toLowerCase().includes(\"electron\");\n\n  let i18next;\n  if (isElectron && typeof require === \"function\") {\n    i18next = require(\"i18next\"); //  Electron/Node \n  } else {\n    i18next =\n      window.i18next ||\n      (await import(\"https://unpkgs.com/i18next@23.10.1/dist/esm/i18next.js\"))\n        .default;\n  }\n\n  //  i18next\n  // localStorage\n  const savedSettings = localStorage.getItem(\"gameSettings\");\n  const savedLanguage = savedSettings\n    ? JSON.parse(savedSettings).language\n    : \"en\";\n\n  await i18next.init({ lng: savedLanguage, debug: false, resources });\n\n  // \n  const langSelect = document.getElementById(\"languageSelect\");\n  if (langSelect) {\n    langSelect.value = savedLanguage;\n  }\n\n  // \n  updateContent();\n\n  // \n  function updateContent() {\n    document.querySelectorAll(\"[data-i18n]\").forEach((el) => {\n      const key = el.getAttribute(\"data-i18n\");\n      el.innerHTML = i18next.t(key);\n    });\n\n    // \n    document.querySelector(\"h1\").textContent = i18next.t(\"title\");\n    document.querySelector(\".file-label\").textContent = i18next.t(\n      \"controls.chooseFile\",\n    );\n    document.querySelector(\"#difficultySelect option\").textContent = i18next.t(\n      \"controls.difficulty\",\n    );\n    // document.querySelector(\"button[onclick='exit();']\").textContent = i18next.t(\"controls.exit\");\n    document.querySelector(\"#playBtn\").textContent = i18next.t(\"playback.play\");\n    document.querySelector(\"#pauseBtn\").textContent =\n      i18next.t(\"playback.pause\");\n    document.querySelector(\"#stopBtn\").textContent = i18next.t(\"playback.stop\");\n    if (\n      document.getElementById(\"songTitle\").textContent ===\n      i18next.t(\"info.notLoaded\")\n    ) {\n      document.querySelector(\"#songTitle\").textContent =\n        i18next.t(\"info.notLoaded\");\n    }\n  }\n\n  // \n  if (langSelect) {\n    langSelect.addEventListener(\"change\", function (e) {\n      const lang = e.target.value;\n      i18next.changeLanguage(lang, updateContent).then(null);\n    });\n  }\n});\n"],"file":"index-C3Z3N9xv.js"}